{% extends "opendims/base.html" %}

{% load staticfiles leaflet_tags verbose_names %}

{% block opendims_title %} - {{ event }}{% endblock %}

{% block extra_css %}

{% leaflet_css %}

<style>
.leaflet-container {
    height: 400px;
}
</style>

{% endblock %}

{% block opendims_content %}

<div class="page-header">
    <h1>EVENT</h1>
</div>

<table class="table table-striped table-bordered table-hover table-condensed">
    <tbody>
        <tr>
          <th>{% get_verbose_field_name event 'created' %}</th>
            <td>{{ event.created }}</td>
        </tr>
        <tr>
          <th>{% get_verbose_field_name event 'disaster' %}</th>
            <td>{{ event.disaster }}</td>
        </tr>
        <tr>
          <th>{% get_verbose_field_name event 'height' %}</th>
            <td>{{ event.height }}</td>
        </tr>
        <tr>
          <th>{% get_verbose_field_name event 'magnitude' %}</th>
            <td>{{ event.magnitude }}</td>
        </tr>
        <tr>
         <th>{% get_verbose_field_name event 'note' %}</th>
            <td>{{ event.note }}</td>
        </tr>
        <tr>
         <th></th>
        </tr>
    </tbody>
</table>

{% leaflet_map "country_map" callback="window.event_map_init" %}

<div><h1>REPORT</h1></div>
<table class="table table-condensed">
    <thead>
      <tr>
          {% for report in reports|slice:'1' %}
            <th>{% get_verbose_field_name report 'created' %}</th>
            <th>{% get_verbose_field_name report 'updated' %}</th>
            <th>{% get_verbose_field_name report 'event' %}</th>
            <th>{% get_verbose_field_name report 'source' %}</th>
            <th>{% get_verbose_field_name report 'status' %}</th>
            <th>{% get_verbose_field_name report 'note' %}</th>
          {% endfor %}
      </tr>
    </thead>
    <tbody>
        {% for report in reports %}
        <tr>
          <td><a href="{% url 'reports:report_detail' report.pk  %}">{{ report.created }}</a></td>
          <td>{{ report.updated }}</td>
          <td>{{ report.event }}</td>
          <td>{{ report.source }}</td>
          <td>{{ report.status }}</td>
          <td>{{ report.note }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}

{% block extra_js %}

{% leaflet_js %}

<script type="text/javascript">
    function event_map_init(map, options) {
      {% if event.province %}
      L.geoJson({{ event.province.polygon.geojson|safe }}).addTo(map);
      {% endif %}

      {% if event.city %}
      L.geoJson({{ event.city.polygon.geojson|safe }}).addTo(map);
      {% endif %}

      {% if event.subdistrict %}
      L.geoJson({{ event.subdistrict.polygon.geojson|safe }}).addTo(map);
      {% endif %}

      {% if event.village %}
      L.geoJson({{ event.village.polygon.geojson|safe }}).addTo(map);
      {% endif %}

      {% if event.rw %}
      L.geoJson({{ event.rw.polygon.geojson|safe }}).addTo(map);
      {% endif %}

      {% if event.rt %}
      L.geoJson({{ event.rt.polygon.geojson|safe }}).addTo(map);
      {% endif %}

      {% if event.point %}
      L.geoJson({{ event.point.geojson|safe }}).addTo(map);
      {% endif %}
    }
</script>

{% endblock %}