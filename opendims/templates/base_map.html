<!DOCTYPE html>

{% load staticfiles %}

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Open-DiMS</title>

    <link rel="stylesheet" href="{% static 'bootstrap/dist/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'font-awesome/css/font-awesome.min.css' %}">
    <link rel="stylesheet" href="{% static 'leaflet/leaflet.css' %}">
    <link rel="stylesheet" href="{% static 'bootleaf_example/assets/css/MarkerCluster.css' %}">
    <link rel="stylesheet" href="{% static 'bootleaf_example/assets/css/MarkerCluster.Default.css' %}">
    <link rel="stylesheet" href="{% static 'bootleaf_example/assets/css/L.Control.Locate.css' %}">
    <link rel="stylesheet" href="{% static 'bootleaf_example/assets/css/leaflet.groupedlayercontrol.css' %}">
    <link rel="stylesheet" href="{% static 'bootleaf_example/assets/css/app.css' %}">

    <link rel="apple-touch-icon" sizes="76x76" href="{% static 'bootleaf_example/assets/img/favicon-76.png' %}">
    <link rel="apple-touch-icon" sizes="120x120" href="{% static 'bootleaf_example/assets/img/favicon-120.png' %}">
    <link rel="apple-touch-icon" sizes="152x152" href="{% static 'bootleaf_example/assets/img/favicon-152.png' %}">
    <link rel="icon" sizes="196x196" href="{% static 'bootleaf_example/assets/img/favicon-196.png' %}">
    <link rel="icon" type="image/x-icon" href="{% static 'bootleaf_example/assets/img/favicon.ico' %}">
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <div class="navbar-icon-container">
            <a href="#" class="navbar-icon pull-right visible-xs" id="nav-btn"><i class="fa fa-bars fa-lg white"></i></a>
            <a href="#" class="navbar-icon pull-right visible-xs" id="sidebar-toggle-btn"><i class="fa fa-search fa-lg white"></i></a>
          </div>
          <a class="navbar-brand" href="#">Open-DiMS</a>
        </div>
        <div class="navbar-collapse collapse">
          <form class="navbar-form navbar-right" role="search">
            <div class="form-group has-feedback">
                <input id="searchbox" type="text" placeholder="Search" class="form-control">
                <span id="searchicon" class="fa fa-search form-control-feedback"></span>
            </div>
          </form>
          <ul class="nav navbar-nav">
            <li><a href="#" data-toggle="collapse" data-target=".navbar-collapse.in" id="about-btn"><i class="fa fa-question-circle white"></i>&nbsp;&nbsp;About</a></li>
            <li class="dropdown">
              <a id="toolsDrop" href="#" role="button" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-globe white"></i>&nbsp;&nbsp;Tools <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="#" data-toggle="collapse" data-target=".navbar-collapse.in" id="full-extent-btn"><i class="fa fa-arrows-alt"></i>&nbsp;&nbsp;Zoom To Full Extent</a></li>
                <li><a href="#" data-toggle="collapse" data-target=".navbar-collapse.in" id="legend-btn"><i class="fa fa-picture-o"></i>&nbsp;&nbsp;Show Legend</a></li>
                <li class="divider hidden-xs"></li>
                <li><a href="#" data-toggle="collapse" data-target=".navbar-collapse.in" id="login-btn"><i class="fa fa-user"></i>&nbsp;&nbsp;Login</a></li>
              </ul>
            </li>
            <li class="dropdown">
                <a class="dropdown-toggle" id="downloadDrop" href="#" role="button" data-toggle="dropdown"><i class="fa fa-cloud-download white"></i>&nbsp;&nbsp;Download <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="data/boroughs.geojson" download="boroughs.geojson" target="_blank" data-toggle="collapse" data-target=".navbar-collapse.in"><i class="fa fa-download"></i>&nbsp;&nbsp;Boroughs</a></li>
                  <li><a href="data/subways.geojson" download="subways.geojson" target="_blank" data-toggle="collapse" data-target=".navbar-collapse.in"><i class="fa fa-download"></i>&nbsp;&nbsp;Subway Lines</a></li>
                  <li><a href="data/DOITT_THEATER_01_13SEPT2010.geojson" download="theaters.geojson" target="_blank" data-toggle="collapse" data-target=".navbar-collapse.in"><i class="fa fa-download"></i>&nbsp;&nbsp;Theaters</a></li>
                  <li><a href="data/DOITT_MUSEUM_01_13SEPT2010.geojson" download="museums.geojson" target="_blank" data-toggle="collapse" data-target=".navbar-collapse.in"><i class="fa fa-download"></i>&nbsp;&nbsp;Museums</a></li>
                </ul>
            </li>
            <li class="hidden-xs"><a href="#" data-toggle="collapse" data-target=".navbar-collapse.in" id="list-btn"><i class="fa fa-list white"></i>&nbsp;&nbsp;POI List</a></li>
          </ul>
        </div><!--/.navbar-collapse -->
      </div>
    </div>

    <div id="container">
      <div id="sidebar">
        <div class="sidebar-wrapper">
          <div class="panel panel-default" id="features">
            <div class="panel-heading">
              <h3 class="panel-title">Points of Interest
              <button type="button" class="btn btn-xs btn-default pull-right" id="sidebar-hide-btn"><i class="fa fa-chevron-left"></i></button></h3>
            </div>
            <div class="panel-body">
              <div class="row">
                <div class="col-xs-8 col-md-8">
                  <input type="text" class="form-control search" placeholder="Filter" />
                </div>
                <div class="col-xs-4 col-md-4">
                  <button type="button" class="btn btn-primary pull-right sort" data-sort="feature-name" id="sort-btn"><i class="fa fa-sort"></i>&nbsp;&nbsp;Sort</button>
                </div>
              </div>
            </div>
            <div class="sidebar-table">
              <table class="table table-hover" id="feature-list">
                <thead class="hidden">
                  <tr>
                    <th>Icon</th>
                  <tr>
                  <tr>
                    <th>Name</th>
                  <tr>
                  <tr>
                    <th>Chevron</th>
                  <tr>
                </thead>
                <tbody class="list"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div id="map"></div>
    </div>
    <div id="loading">
      <div class="loading-indicator">
        <div class="progress progress-striped active">
          <div class="progress-bar progress-bar-info progress-bar-full"></div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="aboutModal" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <button class="close" type="button" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">Welcome to the BootLeaf template!</h4>
          </div>
          <div class="modal-body">
            <ul class="nav nav-tabs nav-justified" id="aboutTabs">
              <li class="active"><a href="#about" data-toggle="tab"><i class="fa fa-question-circle"></i>&nbsp;About the project</a></li>
              <li><a href="#contact" data-toggle="tab"><i class="fa fa-envelope"></i>&nbsp;Contact us</a></li>
              <li><a href="#disclaimer" data-toggle="tab"><i class="fa fa-exclamation-circle"></i>&nbsp;Disclaimer</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-globe"></i>&nbsp;Metadata <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="#boroughs-tab" data-toggle="tab">Boroughs</a></li>
                  <li><a href="#subway-lines-tab" data-toggle="tab">Subway Lines</a></li>
                  <li><a href="#theaters-tab" data-toggle="tab">Theaters</a></li>
                  <li><a href="#museums-tab" data-toggle="tab">Museums</a></li>
                </ul>
              </li>
            </ul>
            <div class="tab-content" id="aboutTabsContent">
              <div class="tab-pane fade active in" id="about">
                <p>A simple, responsive template for building web mapping applications with <a href="http://getbootstrap.com/">Bootstrap 3</a>, <a href="http://leafletjs.com/" target="_blank">Leaflet</a>, and <a href="http://twitter.github.io/typeahead.js/" target="_blank">typeahead.js</a>. Open source, MIT licensed, and available on <a href="https://github.com/bmcbride/bootleaf" target="_blank">GitHub</a>.</p>
                <div class="panel panel-primary">
                  <div class="panel-heading">Features</div>
                  <ul class="list-group">
                    <li class="list-group-item">Fullscreen mobile-friendly map template with responsive navbar and modal placeholders</li>
                    <li class="list-group-item">jQuery loading of external GeoJSON files</li>
                    <li class="list-group-item">Logical multiple layer marker clustering via the <a href="https://github.com/Leaflet/Leaflet.markercluster" target="_blank">leaflet marker cluster plugin</a></li>
                    <li class="list-group-item">Elegant client-side multi-layer feature search with autocomplete using <a href="http://twitter.github.io/typeahead.js/" target="_blank">typeahead.js</a></li>
                    <li class="list-group-item">Responsive sidebar feature list synced with map bounds, which includes sorting and filtering via <a href="http://listjs.com/" target="_blank">list.js</a></li>
                    <li class="list-group-item">Marker icons included in grouped layer control via the <a href="https://github.com/ismyrnow/Leaflet.groupedlayercontrol" target="_blank">grouped layer control plugin</a></li>
                  </ul>
                </div>
              </div>
              <div id="disclaimer" class="tab-pane fade text-danger">
                <p>The data provided on this site is for informational and planning purposes only.</p>
                <p>Absolutely no accuracy or completeness guarantee is implied or intended. All information on this map is subject to such variations and corrections as might result from a complete title search and/or accurate field survey.</p>
              </div>
              <div class="tab-pane fade" id="contact">
                <form id="contact-form">
                  <div class="well well-sm">
                    <div class="row">
                      <div class="col-md-4">
                        <div class="form-group">
                          <label for="first-name">First Name:</label>
                          <input type="text" class="form-control" id="first-name">
                        </div>
                        <div class="form-group">
                          <label for="last-name">Last Name:</label>
                          <input type="text" class="form-control" id="last-email">
                        </div>
                        <div class="form-group">
                          <label for="email">Email:</label>
                          <input type="text" class="form-control" id="email">
                        </div>
                      </div>
                      <div class="col-md-8">
                        <label for="message">Message:</label>
                        <textarea class="form-control" rows="8" id="message"></textarea>
                      </div>
                      <div class="col-md-12">
                        <p>
                          <button type="submit" class="btn btn-primary pull-right" data-dismiss="modal">Submit</button>
                        </p>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
              <div class="tab-pane fade" id="boroughs-tab">
                <p>Borough data courtesy of <a href="http://www.nyc.gov/html/dcp/pdf/bytes/nybbwi_metadata.pdf" target="_blank">New York City Department of City Planning</a></p>
              </div>
              <div class="tab-pane fade" id="subway-lines-tab">
                <p><a href="http://spatialityblog.com/2010/07/08/mta-gis-data-update/#datalinks" target="_blank">MTA Subway data</a> courtesy of the <a href="http://www.urbanresearch.org/about/cur-components/cuny-mapping-service" target="_blank">CUNY Mapping Service at the Center for Urban Research</a></p>
              </div>
              <div class="tab-pane fade" id="theaters-tab">
                <p>Theater data courtesy of <a href="https://data.cityofnewyork.us/Recreation/Theaters/kdu2-865w" target="_blank">NYC Department of Information & Telecommunications (DoITT)</a></p>
              </div>
              <div class="tab-pane fade" id="museums-tab">
                <p>Museum data courtesy of <a href="https://data.cityofnewyork.us/Recreation/Museums-and-Galleries/sat5-adpb" target="_blank">NYC Department of Information & Telecommunications (DoITT)</a></p>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="modal fade" id="legendModal" tabindex="-1" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">Map Legend</h4>
          </div>
          <div class="modal-body">
            <p>Map Legend goes here...</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="modal fade" id="loginModal" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">Login</h4>
          </div>
          <div class="modal-body">
            <form id="contact-form">
              <fieldset>
                <div class="form-group">
                  <label for="name">Username:</label>
                  <input type="text" class="form-control" id="username">
                </div>
                <div class="form-group">
                  <label for="email">Password:</label>
                  <input type="password" class="form-control" id="password">
                </div>
              </fieldset>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary" data-dismiss="modal">Login</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="modal fade" id="featureModal" tabindex="-1" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button class="close" type="button" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title text-primary" id="feature-title"></h4>
          </div>
          <div class="modal-body" id="feature-info"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="modal fade" id="attributionModal" tabindex="-1" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button class="close" type="button" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">
              Developed by <a href='http://bryanmcbride.com'>bryanmcbride.com</a>
            </h4>
          </div>
          <div class="modal-body">
            <div id="attribution"></div>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <script src="{% static 'jquery/dist/jquery.min.js' %}"></script>
    <script src="{% static 'bootstrap/dist/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'bootleaf_example/assets/js/typeahead.bundle.min.js' %}"></script>
    <script src="{% static 'bootleaf_example/assets/js/handlebars.min.js' %}"></script>
    <script src="{% static 'bootleaf_example/assets/js/list.min.js' %}"></script>
    <script src="{% static 'leaflet/leaflet.js' %}"></script>
    <script src="{% static 'bootleaf_example/assets/js/leaflet.markercluster.js' %}"></script>
    <script src="{% static 'bootleaf_example/assets/js/L.Control.Locate.min.js' %}"></script>
    <script src="{% static 'bootleaf_example/assets/js/leaflet.groupedlayercontrol.js' %}"></script>
    <!--
    <script src="{% static 'bootleaf_example/assets/js/app.js' %}"></script>
    -->

    <script type="text/javascript">
    $(document).ready(function(){
        var map, featureList, boroughSearch = [], theaterSearch = [], museumSearch = [];

        $(window).resize(function() {
          sizeLayerControl();
        });

        $(document).on("click", ".feature-row", function(e) {
          $(document).off("mouseout", ".feature-row", clearHighlight);
          sidebarClick(parseInt($(this).attr("id"), 10));
        });

        if ( !("ontouchstart" in window) ) {
          $(document).on("mouseover", ".feature-row", function(e) {
            highlight.clearLayers().addLayer(L.circleMarker([$(this).attr("lat"), $(this).attr("lng")], highlightStyle));
          });
        }

        $(document).on("mouseout", ".feature-row", clearHighlight);

        $("#about-btn").click(function() {
          $("#aboutModal").modal("show");
          $(".navbar-collapse.in").collapse("hide");
          return false;
        });

        $("#full-extent-btn").click(function() {
          map.fitBounds(boroughs.getBounds());
          $(".navbar-collapse.in").collapse("hide");
          return false;
        });

        $("#legend-btn").click(function() {
          $("#legendModal").modal("show");
          $(".navbar-collapse.in").collapse("hide");
          return false;
        });

        $("#login-btn").click(function() {
          $("#loginModal").modal("show");
          $(".navbar-collapse.in").collapse("hide");
          return false;
        });

        $("#list-btn").click(function() {
          $('#sidebar').toggle();
          map.invalidateSize();
          return false;
        });

        $("#nav-btn").click(function() {
          $(".navbar-collapse").collapse("toggle");
          return false;
        });

        $("#sidebar-toggle-btn").click(function() {
          $("#sidebar").toggle();
          map.invalidateSize();
          return false;
        });

        $("#sidebar-hide-btn").click(function() {
          $('#sidebar').hide();
          map.invalidateSize();
        });

        function sizeLayerControl() {
          $(".leaflet-control-layers").css("max-height", $("#map").height() - 50);
        }

        function clearHighlight() {
          highlight.clearLayers();
        }

        function sidebarClick(id) {
          var layer = markerClusters.getLayer(id);
          map.setView([layer.getLatLng().lat, layer.getLatLng().lng], 17);
          layer.fire("click");
          /* Hide sidebar and go to the map on small screens */
          if (document.body.clientWidth <= 767) {
            $("#sidebar").hide();
            map.invalidateSize();
          }
        }

        function syncSidebar() {
          /* Empty sidebar features */
          $("#feature-list tbody").empty();
          /* Loop through theaters layer and add only features which are in the map bounds */
          theaters.eachLayer(function (layer) {
            if (map.hasLayer(theaterLayer)) {
              if (map.getBounds().contains(layer.getLatLng())) {
                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + layer.getLatLng().lat + '" lng="' + layer.getLatLng().lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'bootleaf_example/assets/img/theater.png' %}"></td><td class="feature-name">' + layer.feature.properties.NAME + '</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
              }
            }
          });
          /* Loop through museums layer and add only features which are in the map bounds */
          museums.eachLayer(function (layer) {
            if (map.hasLayer(museumLayer)) {
              if (map.getBounds().contains(layer.getLatLng())) {
                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + layer.getLatLng().lat + '" lng="' + layer.getLatLng().lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'bootleaf_example/assets/img/museum.png' %}"></td><td class="feature-name">' + layer.feature.properties.NAME + '</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
              }
            }
          });
          /* Update list.js featureList */
          featureList = new List("features", {
            valueNames: ["feature-name"]
          });
          featureList.sort("feature-name", {
            order: "asc"
          });
        }

        /* Basemap Layers */
        var mapquestOSM = L.tileLayer("https://{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png", {
          maxZoom: 19,
          subdomains: ["otile1-s", "otile2-s", "otile3-s", "otile4-s"],
          attribution: 'Tiles courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="https://developer.mapquest.com/content/osm/mq_logo.png">. Map data (c) <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors, CC-BY-SA.'
        });
        var mapquestOAM = L.tileLayer("https://{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.jpg", {
          maxZoom: 18,
          subdomains: ["otile1-s", "otile2-s", "otile3-s", "otile4-s"],
          attribution: 'Tiles courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a>. Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency'
        });
        var mapquestHYB = L.layerGroup([L.tileLayer("https://{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.jpg", {
          maxZoom: 18,
          subdomains: ["otile1-s", "otile2-s", "otile3-s", "otile4-s"]
        }), L.tileLayer("https://{s}.mqcdn.com/tiles/1.0.0/hyb/{z}/{x}/{y}.png", {
          maxZoom: 19,
          subdomains: ["otile1-s", "otile2-s", "otile3-s", "otile4-s"],
          attribution: 'Labels courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="https://developer.mapquest.com/content/osm/mq_logo.png">. Map data (c) <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors, CC-BY-SA. Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency'
        })]);

        /* Overlay Layers */
        var highlight = L.geoJson(null);
        var highlightStyle = {
          stroke: false,
          fillColor: "#00FFFF",
          fillOpacity: 0.7,
          radius: 10
        };

        var boroughs = L.geoJson(null, {
          style: function (feature) {
            return {
              color: "black",
              fill: false,
              opacity: 1,
              clickable: false
            };
          },
          onEachFeature: function (feature, layer) {
            boroughSearch.push({
              name: layer.feature.properties.BoroName,
              source: "Boroughs",
              id: L.stamp(layer),
              bounds: layer.getBounds()
            });
          }
        });
        $.getJSON("{% static 'bootleaf_example/data/boroughs.geojson' %}", function (data) {
          boroughs.addData(data);
        });

        var subwayLines = L.geoJson(null, {
          style: function (feature) {
            if (feature.properties.route_id === "1" || feature.properties.route_id === "2" || feature.properties.route_id === "3") {
              return {
                color: "#ff3135",
                weight: 3,
                opacity: 1
              };
            }
            if (feature.properties.route_id === "4" || feature.properties.route_id === "5" || feature.properties.route_id === "6") {
              return {
                color: "#009b2e",
                weight: 3,
                opacity: 1
              };
            }
            if (feature.properties.route_id === "7") {
              return {
                color: "#ce06cb",
                weight: 3,
                opacity: 1
              };
            }
            if (feature.properties.route_id === "A" || feature.properties.route_id === "C" || feature.properties.route_id === "E" || feature.properties.route_id === "SI" || feature.properties.route_id === "H") {
              return {
                color: "#fd9a00",
                weight: 3,
                opacity: 1
              };
            }
            if (feature.properties.route_id === "Air") {
              return {
                color: "#ffff00",
                weight: 3,
                opacity: 1
              };
            }
            if (feature.properties.route_id === "B" || feature.properties.route_id === "D" || feature.properties.route_id === "F" || feature.properties.route_id === "M") {
              return {
                color: "#ffff00",
                weight: 3,
                opacity: 1
              };
            }
            if (feature.properties.route_id === "G") {
              return {
                color: "#9ace00",
                weight: 3,
                opacity: 1
              };
            }
            if (feature.properties.route_id === "FS" || feature.properties.route_id === "GS") {
              return {
                color: "#6e6e6e",
                weight: 3,
                opacity: 1
              };
            }
            if (feature.properties.route_id === "J" || feature.properties.route_id === "Z") {
              return {
                color: "#976900",
                weight: 3,
                opacity: 1
              };
            }
            if (feature.properties.route_id === "L") {
              return {
                color: "#969696",
                weight: 3,
                opacity: 1
              };
            }
            if (feature.properties.route_id === "N" || feature.properties.route_id === "Q" || feature.properties.route_id === "R") {
              return {
                color: "#ffff00",
                weight: 3,
                opacity: 1
              };
            }
          },
          onEachFeature: function (feature, layer) {
            if (feature.properties) {
              var content = "<table class='table table-striped table-bordered table-condensed'>" + "<tr><th>Division</th><td>" + feature.properties.Division + "</td></tr>" + "<tr><th>Line</th><td>" + feature.properties.Line + "</td></tr>" + "<table>";
              layer.on({
                click: function (e) {
                  $("#feature-title").html(feature.properties.Line);
                  $("#feature-info").html(content);
                  $("#featureModal").modal("show");

                }
              });
            }
            layer.on({
              mouseover: function (e) {
                var layer = e.target;
                layer.setStyle({
                  weight: 3,
                  color: "#00FFFF",
                  opacity: 1
                });
                if (!L.Browser.ie && !L.Browser.opera) {
                  layer.bringToFront();
                }
              },
              mouseout: function (e) {
                subwayLines.resetStyle(e.target);
              }
            });
          }
        });
        $.getJSON("{% static 'bootleaf_example/data/subways.geojson' %}", function (data) {
          subwayLines.addData(data);
        });

        /* Single marker cluster layer to hold all clusters */
        var markerClusters = new L.MarkerClusterGroup({
          spiderfyOnMaxZoom: true,
          showCoverageOnHover: false,
          zoomToBoundsOnClick: true,
          disableClusteringAtZoom: 16
        });

        /* Empty layer placeholder to add to layer control for listening when to add/remove theaters to markerClusters layer */
        var theaterLayer = L.geoJson(null);
        var theaters = L.geoJson(null, {
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {
              icon: L.icon({
                iconUrl: "{% static 'bootleaf_example/assets/img/theater.png' %}",
                iconSize: [24, 28],
                iconAnchor: [12, 28],
                popupAnchor: [0, -25]
              }),
              title: feature.properties.NAME,
              riseOnHover: true
            });
          },
          onEachFeature: function (feature, layer) {
            if (feature.properties) {
              var content = "<table class='table table-striped table-bordered table-condensed'>" + "<tr><th>Name</th><td>" + feature.properties.NAME + "</td></tr>" + "<tr><th>Phone</th><td>" + feature.properties.TEL + "</td></tr>" + "<tr><th>Address</th><td>" + feature.properties.ADDRESS1 + "</td></tr>" + "<tr><th>Website</th><td><a class='url-break' href='" + feature.properties.URL + "' target='_blank'>" + feature.properties.URL + "</a></td></tr>" + "<table>";
              layer.on({
                click: function (e) {
                  $("#feature-title").html(feature.properties.NAME);
                  $("#feature-info").html(content);
                  $("#featureModal").modal("show");
                  highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                }
              });
              $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + layer.getLatLng().lat + '" lng="' + layer.getLatLng().lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'bootleaf_example/assets/img/theater.png' %}"></td><td class="feature-name">' + layer.feature.properties.NAME + '</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
              theaterSearch.push({
                name: layer.feature.properties.NAME,
                address: layer.feature.properties.ADDRESS1,
                source: "Theaters",
                id: L.stamp(layer),
                lat: layer.feature.geometry.coordinates[1],
                lng: layer.feature.geometry.coordinates[0]
              });
            }
          }
        });
        $.getJSON("{% static 'bootleaf_example/data/DOITT_THEATER_01_13SEPT2010.geojson' %}", function (data) {
          theaters.addData(data);
          map.addLayer(theaterLayer);
        });

        /* Empty layer placeholder to add to layer control for listening when to add/remove museums to markerClusters layer */
        var museumLayer = L.geoJson(null);
        var museums = L.geoJson(null, {
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {
              icon: L.icon({
                iconUrl: "{% static 'bootleaf_example/assets/img/museum.png' %}",
                iconSize: [24, 28],
                iconAnchor: [12, 28],
                popupAnchor: [0, -25]
              }),
              title: feature.properties.NAME,
              riseOnHover: true
            });
          },
          onEachFeature: function (feature, layer) {
            if (feature.properties) {
              var content = "<table class='table table-striped table-bordered table-condensed'>" + "<tr><th>Name</th><td>" + feature.properties.NAME + "</td></tr>" + "<tr><th>Phone</th><td>" + feature.properties.TEL + "</td></tr>" + "<tr><th>Address</th><td>" + feature.properties.ADRESS1 + "</td></tr>" + "<tr><th>Website</th><td><a class='url-break' href='" + feature.properties.URL + "' target='_blank'>" + feature.properties.URL + "</a></td></tr>" + "<table>";
              layer.on({
                click: function (e) {
                  $("#feature-title").html(feature.properties.NAME);
                  $("#feature-info").html(content);
                  $("#featureModal").modal("show");
                  highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                }
              });
              $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + layer.getLatLng().lat + '" lng="' + layer.getLatLng().lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'bootleaf_example/assets/img/museum.png' %}"></td><td class="feature-name">' + layer.feature.properties.NAME + '</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
              museumSearch.push({
                name: layer.feature.properties.NAME,
                address: layer.feature.properties.ADRESS1,
                source: "Museums",
                id: L.stamp(layer),
                lat: layer.feature.geometry.coordinates[1],
                lng: layer.feature.geometry.coordinates[0]
              });
            }
          }
        });
        $.getJSON("{% static 'bootleaf_example/data/DOITT_MUSEUM_01_13SEPT2010.geojson' %}", function (data) {
          museums.addData(data);
        });















        //DISASTER
        var BJRLayer = L.geoJson(null)
        var LSRLayer = L.geoJson(null)
        var KBKLayer = L.geoJson(null)
        var GMPLayer = L.geoJson(null)
        var CEKLayer = L.geoJson(null)
        var ROBLayer = L.geoJson(null)
        var ABRLayer = L.geoJson(null)
        var TSULayer = L.geoJson(null)
        var SOSLayer = L.geoJson(null)
        var TERLayer = L.geoJson(null)
        var LAILayer = L.geoJson(null)

        var LAI = L.geoJson(null, {
          style: function (feature) {
            return {
              color: "blue",
              fill: true,
              opacity: 1,
              clickable: true
            };
          },
            onEachFeature: function (feature, layer) {

            console.log('LAI');

            if (feature.geometry.type === 'MultiPolygon' && feature.properties) {

                console.log('LAI 2');

                // Don't stroke and do opaque fill
                //layer.setStyle({
                //    'weight': 0,
                //    'fillOpacity': 0
                //});

                // Get bounds of polygon
                var bounds = layer.getBounds();
                // Get center of bounds

                var center = bounds.getCenter();
                console.log(center);



                popupContent = feature.properties.disaster + ': ' + feature.properties.rw


                // Use center to put marker on map
                var marker = L.marker(center, {
                  icon: L.icon({
                    iconUrl: "{% static 'img/markers/treedown.png' %}",
                    iconSize: [24, 28],
                    iconAnchor: [12, 28],
                    popupAnchor: [0, -25]
                  }),
                  title: popupContent,
                  riseOnHover: true
                }).addTo(map);

                layer.bindPopup(popupContent);

                /*
                var content = "<table class='table table-striped table-bordered table-condensed'>" + "<tr><th>Name</th><td>" + feature.properties.NAME + "</td></tr>" + "<tr><th>Phone</th><td>" + feature.properties.TEL + "</td></tr>" + "<tr><th>Address</th><td>" + feature.properties.ADRESS1 + "</td></tr>" + "<tr><th>Website</th><td><a class='url-break' href='" + feature.properties.URL + "' target='_blank'>" + feature.properties.URL + "</a></td></tr>" + "<table>";
                layer.on({
                  click: function (e) {
                    $("#feature-title").html(feature.properties.NAME);
                    $("#feature-info").html(content);
                    $("#featureModal").modal("show");
                    highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                  }
                });
                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + layer.getLatLng().lat + '" lng="' + layer.getLatLng().lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/museum.png"></td><td class="feature-name">' + layer.feature.properties.NAME + '</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                museumSearch.push({
                  name: layer.feature.properties.NAME,
                  address: layer.feature.properties.ADRESS1,
                  source: "Museums",
                  id: L.stamp(layer),
                  lat: layer.feature.geometry.coordinates[1],
                  lng: layer.feature.geometry.coordinates[0]
                });
                */

            }

            if (feature.properties) {

            }
          }
        });
        $.getJSON("{% url 'reports:event_api' %}?disaster=LAI&format=json", function (data) {
          LAI.addData(data);
          console.log(LAI);
          console.log(data);
        });

        var TER = L.geoJson(null, {
          style: function (feature) {
            return {
              color: "blue",
              fill: true,
              opacity: 1,
              clickable: true
            };
          },
          onEachFeature: function (feature, layer) {

          console.log('TER');

            if (feature.geometry.type === 'MultiPolygon' && feature.properties) {

                console.log('TER 2');

                // Don't stroke and do opaque fill
                //layer.setStyle({
                //    'weight': 0,
                //    'fillOpacity': 0
                //});

                // Get bounds of polygon
                var bounds = layer.getBounds();
                // Get center of bounds

                var center = bounds.getCenter();
                console.log(center);



                popupContent = feature.properties.disaster + ': ' + feature.properties.rw


                // Use center to put marker on map
                var marker = L.marker(center, {
                  icon: L.icon({
                    iconUrl: "{% static 'img/markers/shooting.png' %}",
                    iconSize: [24, 28],
                    iconAnchor: [12, 28],
                    popupAnchor: [0, -25]
                  }),
                  title: popupContent,
                  riseOnHover: true
                }).addTo(map);

                layer.bindPopup(popupContent);

                /*
                var content = "<table class='table table-striped table-bordered table-condensed'>" + "<tr><th>Name</th><td>" + feature.properties.NAME + "</td></tr>" + "<tr><th>Phone</th><td>" + feature.properties.TEL + "</td></tr>" + "<tr><th>Address</th><td>" + feature.properties.ADRESS1 + "</td></tr>" + "<tr><th>Website</th><td><a class='url-break' href='" + feature.properties.URL + "' target='_blank'>" + feature.properties.URL + "</a></td></tr>" + "<table>";
                layer.on({
                  click: function (e) {
                    $("#feature-title").html(feature.properties.NAME);
                    $("#feature-info").html(content);
                    $("#featureModal").modal("show");
                    highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                  }
                });
                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + layer.getLatLng().lat + '" lng="' + layer.getLatLng().lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/museum.png"></td><td class="feature-name">' + layer.feature.properties.NAME + '</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                museumSearch.push({
                  name: layer.feature.properties.NAME,
                  address: layer.feature.properties.ADRESS1,
                  source: "Museums",
                  id: L.stamp(layer),
                  lat: layer.feature.geometry.coordinates[1],
                  lng: layer.feature.geometry.coordinates[0]
                });
                */

            }

            if (feature.properties) {

            }
          }
        });
        $.getJSON("{% url 'reports:event_api' %}?disaster=TER&format=json", function (data) {
            TER.addData(data);
            console.log(TER);
            console.log(data);
        });

        var ABR = L.geoJson(null, {
          style: function (feature) {
            return {
              color: "blue",
              fill: true,
              opacity: 1,
              clickable: true
            };
          },

          onEachFeature: function (feature, layer) {
              console.log('ABR');

            if (feature.geometry.type === 'MultiPolygon' && feature.properties) {

              console.log('ABR 2');

                // Don't stroke and do opaque fill
                //layer.setStyle({
                //    'weight': 0,
                //    'fillOpacity': 0
                //});

                // Get bounds of polygon
                var bounds = layer.getBounds();
                // Get center of bounds

                var center = bounds.getCenter();
                console.log(center);



                popupContent = feature.properties.disaster + ': ' + feature.properties.rw


                // Use center to put marker on map
                var marker = L.marker(center, {
                  icon: L.icon({
                    iconUrl: "{% static 'img/markers/abration.png' %}",
                    iconSize: [24, 28],
                    iconAnchor: [12, 28],
                    popupAnchor: [0, -25]
                  }),
                  title: popupContent,
                  riseOnHover: true
                }).addTo(map);

                layer.bindPopup(popupContent);

                /*
                var content = "<table class='table table-striped table-bordered table-condensed'>" + "<tr><th>Name</th><td>" + feature.properties.NAME + "</td></tr>" + "<tr><th>Phone</th><td>" + feature.properties.TEL + "</td></tr>" + "<tr><th>Address</th><td>" + feature.properties.ADRESS1 + "</td></tr>" + "<tr><th>Website</th><td><a class='url-break' href='" + feature.properties.URL + "' target='_blank'>" + feature.properties.URL + "</a></td></tr>" + "<table>";
                layer.on({
                  click: function (e) {
                    $("#feature-title").html(feature.properties.NAME);
                    $("#feature-info").html(content);
                    $("#featureModal").modal("show");
                    highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                  }
                });
                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + layer.getLatLng().lat + '" lng="' + layer.getLatLng().lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/museum.png"></td><td class="feature-name">' + layer.feature.properties.NAME + '</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                museumSearch.push({
                  name: layer.feature.properties.NAME,
                  address: layer.feature.properties.ADRESS1,
                  source: "Museums",
                  id: L.stamp(layer),
                  lat: layer.feature.geometry.coordinates[1],
                  lng: layer.feature.geometry.coordinates[0]
                });
                */

            }

            if (feature.properties) {

            }
          }
        });
        $.getJSON("{% url 'reports:event_api' %}?disaster=ABR&format=json", function (data) {
            ABR.addData(data);
            console.log(ABR);
            console.log(data);
        });


        var TSU = L.geoJson(null, {
          style: function (feature) {
            return {
              color: "blue",
              fill: true,
              opacity: 1,
              clickable: true
            };
          },
          onEachFeature: function (feature, layer) {
            console.log('TSU');

            if (feature.geometry.type === 'MultiPolygon' && feature.properties) {
                console.log('TSU 2');

                // Don't stroke and do opaque fill
                //layer.setStyle({
                //    'weight': 0,
                //    'fillOpacity': 0
                //});

                // Get bounds of polygon
                var bounds = layer.getBounds();
                // Get center of bounds

                var center = bounds.getCenter();
                console.log(center);



                popupContent = feature.properties.disaster + ': ' + feature.properties.rw


                // Use center to put marker on map
                var marker = L.marker(center, {
                  icon: L.icon({
                    iconUrl: "{% static 'img/markers/tsunami.png' %}",
                    iconSize: [24, 28],
                    iconAnchor: [12, 28],
                    popupAnchor: [0, -25]
                  }),
                  title: popupContent,
                  riseOnHover: true
                }).addTo(map);

                layer.bindPopup(popupContent);

                /*
                var content = "<table class='table table-striped table-bordered table-condensed'>" + "<tr><th>Name</th><td>" + feature.properties.NAME + "</td></tr>" + "<tr><th>Phone</th><td>" + feature.properties.TEL + "</td></tr>" + "<tr><th>Address</th><td>" + feature.properties.ADRESS1 + "</td></tr>" + "<tr><th>Website</th><td><a class='url-break' href='" + feature.properties.URL + "' target='_blank'>" + feature.properties.URL + "</a></td></tr>" + "<table>";
                layer.on({
                  click: function (e) {
                    $("#feature-title").html(feature.properties.NAME);
                    $("#feature-info").html(content);
                    $("#featureModal").modal("show");
                    highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                  }
                });
                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + layer.getLatLng().lat + '" lng="' + layer.getLatLng().lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/museum.png"></td><td class="feature-name">' + layer.feature.properties.NAME + '</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                museumSearch.push({
                  name: layer.feature.properties.NAME,
                  address: layer.feature.properties.ADRESS1,
                  source: "Museums",
                  id: L.stamp(layer),
                  lat: layer.feature.geometry.coordinates[1],
                  lng: layer.feature.geometry.coordinates[0]
                });
                */

            }

            if (feature.properties) {

            }
          }
        });
        $.getJSON("{% url 'reports:event_api' %}?disaster=TSU&format=json", function (data) {
            TSU.addData(data);
            console.log(TSU);
            console.log(data);
        });


        var ROB = L.geoJson(null, {
          style: function (feature) {
            return {
              color: "blue",
              fill: true,
              opacity: 1,
              clickable: true
            };
          },
          onEachFeature: function (feature, layer) {
            console.log('ROB');

            if (feature.geometry.type === 'MultiPolygon' && feature.properties) {
                console.log('ROB 2');

                // Don't stroke and do opaque fill
                //layer.setStyle({
                //    'weight': 0,
                //    'fillOpacity': 0
                //});

                // Get bounds of polygon
                var bounds = layer.getBounds();
                // Get center of bounds
                var center = bounds.getCenter();
                console.log(center);

                popupContent = feature.properties.disaster + ': ' + feature.properties.rw

                // Use center to put marker on map
                var marker = L.marker(center, {
                  icon: L.icon({
                    iconUrl: "{% static 'img/markers/seaflood.png' %}",
                    iconSize: [24, 28],
                    iconAnchor: [12, 28],
                    popupAnchor: [0, -25]
                  }),
                  title: popupContent,
                  riseOnHover: true
                }).addTo(map);

                layer.bindPopup(popupContent);

                /*
                var content = "<table class='table table-striped table-bordered table-condensed'>" + "<tr><th>Name</th><td>" + feature.properties.NAME + "</td></tr>" + "<tr><th>Phone</th><td>" + feature.properties.TEL + "</td></tr>" + "<tr><th>Address</th><td>" + feature.properties.ADRESS1 + "</td></tr>" + "<tr><th>Website</th><td><a class='url-break' href='" + feature.properties.URL + "' target='_blank'>" + feature.properties.URL + "</a></td></tr>" + "<table>";
                layer.on({
                  click: function (e) {
                    $("#feature-title").html(feature.properties.NAME);
                    $("#feature-info").html(content);
                    $("#featureModal").modal("show");
                    highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                  }
                });
                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + layer.getLatLng().lat + '" lng="' + layer.getLatLng().lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/museum.png"></td><td class="feature-name">' + layer.feature.properties.NAME + '</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                museumSearch.push({
                  name: layer.feature.properties.NAME,
                  address: layer.feature.properties.ADRESS1,
                  source: "Museums",
                  id: L.stamp(layer),
                  lat: layer.feature.geometry.coordinates[1],
                  lng: layer.feature.geometry.coordinates[0]
                });
                */

            }

            if (feature.properties) {

            }
          }
        });
        $.getJSON("{% url 'reports:event_api' %}?disaster=ROB&format=json", function (data) {
            ROB.addData(data);
            console.log(ROB);
            console.log(data);
        });




        var SOS = L.geoJson(null, {
            style: function (feature) {
            return {
              color: "blue",
              fill: true,
              opacity: 1,
              clickable: true
            };
          },
          onEachFeature: function (feature, layer) {
            console.log('SOS');

            if (feature.geometry.type === 'MultiPolygon' && feature.properties) {
                console.log('SOS 2');

                // Don't stroke and do opaque fill
                //layer.setStyle({
                //    'weight': 0,
                //    'fillOpacity': 0
                //});

                // Get bounds of polygon
                var bounds = layer.getBounds();
                // Get center of bounds

                var center = bounds.getCenter();
                console.log(center);

                popupContent = feature.properties.disaster + ': ' + feature.properties.rw

                // Use center to put marker on map
                var marker = L.marker(center, {
                  icon: L.icon({
                    iconUrl: "{% static 'img/markers/strike.png' %}",
                    iconSize: [24, 28],
                    iconAnchor: [12, 28],
                    popupAnchor: [0, -25]
                  }),
                  title: popupContent,
                  riseOnHover: true
                }).addTo(map);

                layer.bindPopup(popupContent);

                /*
                var content = "<table class='table table-striped table-bordered table-condensed'>" + "<tr><th>Name</th><td>" + feature.properties.NAME + "</td></tr>" + "<tr><th>Phone</th><td>" + feature.properties.TEL + "</td></tr>" + "<tr><th>Address</th><td>" + feature.properties.ADRESS1 + "</td></tr>" + "<tr><th>Website</th><td><a class='url-break' href='" + feature.properties.URL + "' target='_blank'>" + feature.properties.URL + "</a></td></tr>" + "<table>";
                layer.on({
                  click: function (e) {
                    $("#feature-title").html(feature.properties.NAME);
                    $("#feature-info").html(content);
                    $("#featureModal").modal("show");
                    highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                  }
                });
                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + layer.getLatLng().lat + '" lng="' + layer.getLatLng().lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/museum.png"></td><td class="feature-name">' + layer.feature.properties.NAME + '</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                museumSearch.push({
                  name: layer.feature.properties.NAME,
                  address: layer.feature.properties.ADRESS1,
                  source: "Museums",
                  id: L.stamp(layer),
                  lat: layer.feature.geometry.coordinates[1],
                  lng: layer.feature.geometry.coordinates[0]
                });
                */

            }

            if (feature.properties) {

            }
          }
        });
        $.getJSON("{% url 'reports:event_api' %}?disaster=SOS&format=json", function (data) {
            SOS.addData(data);
            console.log(SOS);
            console.log(data);
        });



        var CEK = L.geoJson(null, {
          style: function (feature) {
            return {
              color: "blue",
              fill: true,
              opacity: 1,
              clickable: true
            };
          },
          onEachFeature: function (feature, layer) {
            console.log('CEK');

            if (feature.geometry.type === 'MultiPolygon' && feature.properties) {
                console.log('CEK 2');

                // Don't stroke and do opaque fill
                //layer.setStyle({
                //    'weight': 0,
                //    'fillOpacity': 0
                //});

                // Get bounds of polygon
                var bounds = layer.getBounds();
                // Get center of bounds

                var center = bounds.getCenter();
                console.log(center);


                popupContent = feature.properties.disaster + ': ' + feature.properties.rw


                // Use center to put marker on map
                var marker = L.marker(center, {
                  icon: L.icon({
                    iconUrl: "{% static 'img/markers/tornado.png' %}",
                    iconSize: [24, 28],
                    iconAnchor: [12, 28],
                    popupAnchor: [0, -25]
                  }),
                  title: popupContent,
                  riseOnHover: true
                }).addTo(map);

                layer.bindPopup(popupContent);

                /*
                var content = "<table class='table table-striped table-bordered table-condensed'>" + "<tr><th>Name</th><td>" + feature.properties.NAME + "</td></tr>" + "<tr><th>Phone</th><td>" + feature.properties.TEL + "</td></tr>" + "<tr><th>Address</th><td>" + feature.properties.ADRESS1 + "</td></tr>" + "<tr><th>Website</th><td><a class='url-break' href='" + feature.properties.URL + "' target='_blank'>" + feature.properties.URL + "</a></td></tr>" + "<table>";
                layer.on({
                  click: function (e) {
                    $("#feature-title").html(feature.properties.NAME);
                    $("#feature-info").html(content);
                    $("#featureModal").modal("show");
                    highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                  }
                });
                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + layer.getLatLng().lat + '" lng="' + layer.getLatLng().lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/museum.png"></td><td class="feature-name">' + layer.feature.properties.NAME + '</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                museumSearch.push({
                  name: layer.feature.properties.NAME,
                  address: layer.feature.properties.ADRESS1,
                  source: "Museums",
                  id: L.stamp(layer),
                  lat: layer.feature.geometry.coordinates[1],
                  lng: layer.feature.geometry.coordinates[0]
                });
                */

            }

            if (feature.properties) {

            }
          }
        });
        $.getJSON("{% url 'reports:event_api' %}?disaster=CEK&format=json", function (data) {
            CEK.addData(data);
            console.log(CEK);
            console.log(data);
        });


        var GMP = L.geoJson(null, {
          style: function (feature) {
            return {
              color: "blue",
              fill: true,
              opacity: 1,
              clickable: true
            };
          },
          onEachFeature: function (feature, layer) {
            console.log('GMP');

            if (feature.geometry.type === 'MultiPolygon' && feature.properties) {
                console.log('GMP 2');

                // Don't stroke and do opaque fill
                //layer.setStyle({
                //    'weight': 0,
                //    'fillOpacity': 0
                //});

                // Get bounds of polygon
                var bounds = layer.getBounds();
                // Get center of bounds

                var center = bounds.getCenter();
                console.log(center);

                popupContent = feature.properties.disaster + ': ' + feature.properties.rw


                // Use center to put marker on map
                var marker = L.marker(center, {
                  icon: L.icon({
                    iconUrl: "{% static 'img/markers/earthquake.png' %}",
                    iconSize: [24, 28],
                    iconAnchor: [12, 28],
                    popupAnchor: [0, -25]
                  }),
                  title: popupContent,
                  riseOnHover: true
                }).addTo(map);

                layer.bindPopup(popupContent);

                /*
                var content = "<table class='table table-striped table-bordered table-condensed'>" + "<tr><th>Name</th><td>" + feature.properties.NAME + "</td></tr>" + "<tr><th>Phone</th><td>" + feature.properties.TEL + "</td></tr>" + "<tr><th>Address</th><td>" + feature.properties.ADRESS1 + "</td></tr>" + "<tr><th>Website</th><td><a class='url-break' href='" + feature.properties.URL + "' target='_blank'>" + feature.properties.URL + "</a></td></tr>" + "<table>";
                layer.on({
                  click: function (e) {
                    $("#feature-title").html(feature.properties.NAME);
                    $("#feature-info").html(content);
                    $("#featureModal").modal("show");
                    highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                  }
                });
                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + layer.getLatLng().lat + '" lng="' + layer.getLatLng().lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/museum.png"></td><td class="feature-name">' + layer.feature.properties.NAME + '</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                museumSearch.push({
                  name: layer.feature.properties.NAME,
                  address: layer.feature.properties.ADRESS1,
                  source: "Museums",
                  id: L.stamp(layer),
                  lat: layer.feature.geometry.coordinates[1],
                  lng: layer.feature.geometry.coordinates[0]
                });
                */

            }

            if (feature.properties) {

            }
          }
        });
        $.getJSON("{% url 'reports:event_api' %}?disaster=GMP&format=json", function (data) {
            GMP.addData(data);
            console.log(GMP);
            console.log(data);
        });


        var BJR = L.geoJson(null, {
          style: function (feature) {
            return {
              color: "blue",
              fill: true,
              opacity: 1,
              clickable: true
            };
          },
          onEachFeature: function (feature, layer) {
            console.log('BJR');

            if (feature.geometry.type === 'MultiPolygon' && feature.properties) {
                console.log('BJR 2');

                // Don't stroke and do opaque fill
                //layer.setStyle({
                //    'weight': 0,
                //    'fillOpacity': 0
                //});

                // Get bounds of polygon
                var bounds = layer.getBounds();
                // Get center of bounds

                var center = bounds.getCenter();
                console.log(center);

                popupContent = feature.properties.disaster + ': ' + feature.properties.rw


                // Use center to put marker on map
                var marker = L.marker(center, {
                  icon: L.icon({
                    iconUrl: "{% static 'img/markers/flood.png' %}",
                    iconSize: [24, 28],
                    iconAnchor: [12, 28],
                    popupAnchor: [0, -25]
                  }),
                  title: popupContent,
                  riseOnHover: true
                }).addTo(map);

                layer.bindPopup(popupContent);

                /*
                var content = "<table class='table table-striped table-bordered table-condensed'>" + "<tr><th>Name</th><td>" + feature.properties.NAME + "</td></tr>" + "<tr><th>Phone</th><td>" + feature.properties.TEL + "</td></tr>" + "<tr><th>Address</th><td>" + feature.properties.ADRESS1 + "</td></tr>" + "<tr><th>Website</th><td><a class='url-break' href='" + feature.properties.URL + "' target='_blank'>" + feature.properties.URL + "</a></td></tr>" + "<table>";
                layer.on({
                    click: function (e) {
                    $("#feature-title").html(feature.properties.NAME);
                    $("#feature-info").html(content);
                    $("#featureModal").modal("show");
                    highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                  }
                });
                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + layer.getLatLng().lat + '" lng="' + layer.getLatLng().lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/museum.png"></td><td class="feature-name">' + layer.feature.properties.NAME + '</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                museumSearch.push({
                  name: layer.feature.properties.NAME,
                  address: layer.feature.properties.ADRESS1,
                  source: "Museums",
                  id: L.stamp(layer),
                  lat: layer.feature.geometry.coordinates[1],
                  lng: layer.feature.geometry.coordinates[0]
                });
                */

            }

            if (feature.properties) {

            }
          }
        });
        $.getJSON("{% url 'reports:event_api' %}?disaster=BJR&format=json", function (data) {
            BJR.addData(data);
            console.log(BJR);
            console.log(data);
        });


        //DISASTER

        var LSR = L.geoJson(null, {
            style: function (feature) {
            return {
                    color: "blue",
                    fill: true,
                    opacity: 1,
                    clickable: true
                    };
                  },
            onEachFeature: function (feature, layer) {
            console.log('LSR');

            if (feature.geometry.type === 'MultiPolygon' && feature.properties) {


                        // Don't stroke and do opaque fill
                        //layer.setStyle({
                        //    'weight': 0,
                        //    'fillOpacity': 0
                        //});

                        // Get bounds of polygon
                var bounds = layer.getBounds();
                        // Get center of bounds

                var center = bounds.getCenter();
                console.log(center);



                popupContent = feature.properties.disaster + ': ' + feature.properties.rw


                // Use center to put marker on map
                var marker = L.marker(center, {
                    icon: L.icon({
                        iconUrl: "{% static 'img/markers/avalanche.png' %}",
                        iconSize: [24, 28],
                        iconAnchor: [12, 28],
                        popupAnchor: [0, -25]
                          }),
                        title: popupContent,
                        riseOnHover: true
                        }).addTo(map);

                        layer.bindPopup(popupContent);

                        /*
                        var content = "<table class='table table-striped table-bordered table-condensed'>" + "<tr><th>Name</th><td>" + feature.properties.NAME + "</td></tr>" + "<tr><th>Phone</th><td>" + feature.properties.TEL + "</td></tr>" + "<tr><th>Address</th><td>" + feature.properties.ADRESS1 + "</td></tr>" + "<tr><th>Website</th><td><a class='url-break' href='" + feature.properties.URL + "' target='_blank'>" + feature.properties.URL + "</a></td></tr>" + "<table>";
                        layer.on({
                          click: function (e) {
                            $("#feature-title").html(feature.properties.NAME);
                            $("#feature-info").html(content);
                            $("#featureModal").modal("show");
                            highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                          }
                        });
                        $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + layer.getLatLng().lat + '" lng="' + layer.getLatLng().lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/museum.png"></td><td class="feature-name">' + layer.feature.properties.NAME + '</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                        museumSearch.push({
                          name: layer.feature.properties.NAME,
                          address: layer.feature.properties.ADRESS1,
                          source: "Museums",
                          id: L.stamp(layer),
                          lat: layer.feature.geometry.coordinates[1],
                          lng: layer.feature.geometry.coordinates[0]
                        });
                        */

                    }

                    if (feature.properties) {

                    }
                  }
                });
                $.getJSON("{% url 'reports:event_api' %}?disaster=LSR&format=json", function (data) {
                    LSR.addData(data);
                    console.log(LSR);
                    console.log(data);
                });

                //DISASTER


            var KBK = L.geoJson(null, {
                style: function (feature) {
                return {
                    color: "blue",
                    fill: true,
                    opacity: 1,
                    clickable: true
                        };
                        },
           onEachFeature: function (feature, layer) {
              console.log('KBK');

            if (feature.geometry.type === 'MultiPolygon' && feature.properties) {
              console.log('KBK 2');

                    // Don't stroke and do opaque fill
                    //layer.setStyle({
                    //    'weight': 0,
                    //    'fillOpacity': 0
                    //});

                    // Get bounds of polygon
                    var bounds = layer.getBounds();
                    // Get center of bounds

                    var center = bounds.getCenter();
                        console.log(center);



                    popupContent = feature.properties.disaster + ': ' + feature.properties.rw


                                // Use center to put marker on map
                    var marker = L.marker(center, {
                        icon: L.icon({
                        iconUrl: "{% static 'img/markers/fire.png' %}",
                        iconSize: [24, 28],
                        iconAnchor: [12, 28],
                        popupAnchor: [0, -25]
                        }),
                        title: popupContent,
                        riseOnHover: true
                        }).addTo(map);

                        layer.bindPopup(popupContent);

                        /*
                        var content = "<table class='table table-striped table-bordered table-condensed'>" + "<tr><th>Name</th><td>" + feature.properties.NAME + "</td></tr>" + "<tr><th>Phone</th><td>" + feature.properties.TEL + "</td></tr>" + "<tr><th>Address</th><td>" + feature.properties.ADRESS1 + "</td></tr>" + "<tr><th>Website</th><td><a class='url-break' href='" + feature.properties.URL + "' target='_blank'>" + feature.properties.URL + "</a></td></tr>" + "<table>";
                        layer.on({
                        click: function (e) {
                        $("#feature-title").html(feature.properties.NAME);
                        $("#feature-info").html(content);
                        $("#featureModal").modal("show");
                        highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                            }
                        });
                        $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + layer.getLatLng().lat + '" lng="' + layer.getLatLng().lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/museum.png"></td><td class="feature-name">' + layer.feature.properties.NAME + '</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                        museumSearch.push({
                        name: layer.feature.properties.NAME,
                        address: layer.feature.properties.ADRESS1,
                        source: "Museums",
                        id: L.stamp(layer),
                        lat: layer.feature.geometry.coordinates[1],
                        lng: layer.feature.geometry.coordinates[0]
                        });
                        */

                }

                if (feature.properties) {

                }
                }
                });
                $.getJSON("{% url 'reports:event_api' %}?disaster=KBK&format=json", function (data) {
                    KBK.addData(data);
                    console.log(KBK);
                    console.log(data);
                    });

        map = L.map("map", {
          zoom: 13,
          //center: [40.702222, -73.979378],
          //DISASTER
          center: [-6.134410, 106.813545],
          //DISASTER
          layers: [mapquestOSM, BJRLayer, markerClusters, highlight],
          zoomControl: false,
          attributionControl: false
        });


        /* Layer control listeners that allow for a single markerClusters layer */
        map.on("overlayadd", function(e) {
          if (e.layer === theaterLayer) {
            markerClusters.addLayer(theaters);
            syncSidebar();
          }
          if (e.layer === museumLayer) {
            markerClusters.addLayer(museums);
            syncSidebar();
          }


          //DISASTER
          if (e.layer === BJRLayer) {
            console.log('overlayadd BJR');
            markerClusters.addLayer(BJR);
            syncSidebar();
          }

          if (e.layer === LSRLayer) {
            console.log('overlayadd LSR');
            markerClusters.addLayer(LSR);
            syncSidebar();
          }

          if (e.layer === KBKLayer) {
            console.log('overlayadd KBK');
            markerClusters.addLayer(KBK);
            syncSidebar();
          }

          if (e.layer === GMPLayer) {
            console.log('overlayadd GMP');
            markerClusters.addLayer(GMP);
            syncSidebar();
          }

          if (e.layer === CEKLayer) {
            console.log('overlayadd CEK');
            markerClusters.addLayer(CEK);
            syncSidebar();
          }

          if (e.layer === SOSLayer) {
            console.log('overlayadd SOS');
            markerClusters.addLayer(SOS);
            syncSidebar();
          }

          if (e.layer === ROBLayer) {
            console.log('overlayadd ROB');
            markerClusters.addLayer(ROB);
            syncSidebar();
          }

          if (e.layer === TSULayer) {
            console.log('overlayadd TSU');
            markerClusters.addLayer(TSU);
            syncSidebar();
          }

          if (e.layer === ABRLayer) {
            console.log('overlayadd ABR');
            markerClusters.addLayer(ABR);
            syncSidebar();
          }

          if (e.layer === TERLayer) {
            console.log('overlayadd TER');
            markerClusters.addLayer(TER);
            syncSidebar();
          }

          if (e.layer === LAILayer) {
            console.log('overlayadd LAI');
            markerClusters.addLayer(LAI);
            syncSidebar();
          }

        });

        map.on("overlayremove", function(e) {
          if (e.layer === theaterLayer) {
            markerClusters.removeLayer(theaters);
            syncSidebar();
          }
          if (e.layer === museumLayer) {
            markerClusters.removeLayer(museums);
            syncSidebar();
          }




          //DISASTER
          if (e.layer === BJRLayer) {
            console.log('overlayremove BJR');
            markerClusters.removeLayer(BJR);
            syncSidebar();
          }
          //DISASTER
          if (e.layer === LSRLayer) {
            console.log('overlayremove LSR');
            markerClusters.removeLayer(LSR);
            syncSidebar();
          }
          if (e.layer === KBKLayer) {
            console.log('overlayremove KBK');
            markerClusters.removeLayer(KBK);
            syncSidebar();
          }

          if (e.layer === GMPLayer) {
            console.log('overlayremove GMP');
            markerClusters.removeLayer(GMP);
            syncSidebar();
          }

          if (e.layer === CEKLayer) {
            console.log('overlayremove CEK');
            markerClusters.removeLayer(CEK);
            syncSidebar();
          }

          if (e.layer === SOSLayer) {
            console.log('overlayremove SOS');
            markerClusters.removeLayer(SOS);
            syncSidebar();
          }

          if (e.layer === ROBLayer) {
            console.log('overlayremove ROB');
            markerClusters.removeLayer(ROB);
            syncSidebar();
          }

          if (e.layer === TSULayer) {
            console.log('overlayremove TSU');
            markerClusters.removeLayer(TSU);
            syncSidebar();
          }

          if (e.layer === ABRLayer) {
            console.log('overlayremove ABR');
            markerClusters.removeLayer(ABR);
            syncSidebar();
          }

          if (e.layer === TERLayer) {
            console.log('overlayremove TER');
            markerClusters.removeLayer(TER);
            syncSidebar();
          }

          if (e.layer === LAILayer) {
            console.log('overlayremove LAI');
            markerClusters.removeLayer(LAI);
            syncSidebar();
          }






        });

        /* Filter sidebar feature list to only show features in current map bounds */
        map.on("moveend", function (e) {
          syncSidebar();
        });

        /* Clear feature highlight when map is clicked */
        map.on("click", function(e) {
          highlight.clearLayers();
        });

        /* Attribution control */
        function updateAttribution(e) {
          $.each(map._layers, function(index, layer) {
            if (layer.getAttribution) {
              $("#attribution").html((layer.getAttribution()));
            }
          });
        }
        map.on("layeradd", updateAttribution);
        map.on("layerremove", updateAttribution);

        var attributionControl = L.control({
          position: "bottomright"
        });
        attributionControl.onAdd = function (map) {
          var div = L.DomUtil.create("div", "leaflet-control-attribution");
          div.innerHTML = "<span class='hidden-xs'>Developed by <a href='http://bryanmcbride.com'>bryanmcbride.com</a> | </span><a href='#' onclick='$(\"#attributionModal\").modal(\"show\"); return false;'>Attribution</a>";
          return div;
        };
        map.addControl(attributionControl);

        var zoomControl = L.control.zoom({
          position: "bottomright"
        }).addTo(map);

        /* GPS enabled geolocation control set to follow the user's location */
        var locateControl = L.control.locate({
          position: "bottomright",
          drawCircle: true,
          follow: true,
          setView: true,
          keepCurrentZoomLevel: true,
          markerStyle: {
            weight: 1,
            opacity: 0.8,
            fillOpacity: 0.8
          },
          circleStyle: {
            weight: 1,
            clickable: false
          },
          icon: "fa fa-location-arrow",
          metric: false,
          strings: {
            title: "My location",
            popup: "You are within {distance} {unit} from this point",
            outsideMapBoundsMsg: "You seem located outside the boundaries of the map"
          },
          locateOptions: {
            maxZoom: 18,
            watch: true,
            enableHighAccuracy: true,
            maximumAge: 10000,
            timeout: 10000
          }
        }).addTo(map);

        /* Larger screens get expanded layer control and visible sidebar */
        if (document.body.clientWidth <= 767) {
          var isCollapsed = true;
        } else {
          var isCollapsed = false;
        }

        var baseLayers = {
          "Street Map": mapquestOSM,
          "Aerial Imagery": mapquestOAM,
          "Imagery with Streets": mapquestHYB
        };

        var groupedOverlays = {
          //DISASTER
          "Disaster": {
            "<img src='{% static "img/markers/flood.png" %}' width='24' height='28'>&nbsp;BJR": BJRLayer,
            "<img src='{% static "img/markers/avalanche.png" %}' width='24' height='28'>&nbsp;LSR": LSRLayer,
            "<img src='{% static "img/markers/fire.png" %}' width='24' height='28'>&nbsp;KBK": KBKLayer,
            "<img src='{% static "img/markers/earthquake.png" %}' width='24' height='28'>&nbsp;GMP": GMPLayer,
            "<img src='{% static "img/markers/tornado.png" %}' width='24' height='28'>&nbsp;CEK": CEKLayer,
            "<img src='{% static "img/markers/strike.png" %}' width='24' height='28'>&nbsp;SOS": SOSLayer,
            "<img src='{% static "img/markers/seaflood.png" %}' width='24' height='28'>&nbsp;ROB": ROBLayer,
            "<img src='{% static "img/markers/tsunami.png" %}' width='24' height='28'>&nbsp;TSU": TSULayer,
            "<img src='{% static "img/markers/abration.png" %}' width='24' height='28'>&nbsp;ABR": ABRLayer,
            "<img src='{% static "img/markers/shooting.png" %}' width='24' height='28'>&nbsp;TER": TERLayer,
            "<img src='{% static "img/markers/treedown.png" %}' width='24' height='28'>&nbsp;LAI": LAILayer,
          },
          //DISASTER
          "Reference": {
            "Boroughs": boroughs,
            "Subway Lines": subwayLines
          }
        };

        var layerControl = L.control.groupedLayers(baseLayers, groupedOverlays, {
          collapsed: isCollapsed
        }).addTo(map);

        /* Highlight search box text on click */
        $("#searchbox").click(function () {
          $(this).select();
        });

        /* Prevent hitting enter from refreshing the page */
        $("#searchbox").keypress(function (e) {
          if (e.which == 13) {
            e.preventDefault();
          }
        });

        $("#featureModal").on("hidden.bs.modal", function (e) {
          $(document).on("mouseout", ".feature-row", clearHighlight);
        });

        /* Typeahead search functionality */
        $(document).one("ajaxStop", function () {
          $("#loading").hide();
          sizeLayerControl();
          /* Fit map to boroughs bounds */


          //DISASTER
          map.fitBounds(BJRLayer.getBounds());
          //DISASTER


          featureList = new List("features", {valueNames: ["feature-name"]});
          featureList.sort("feature-name", {order:"asc"});

          var boroughsBH = new Bloodhound({
            name: "Boroughs",
            datumTokenizer: function (d) {
              return Bloodhound.tokenizers.whitespace(d.name);
            },
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            local: boroughSearch,
            limit: 10
          });

          var theatersBH = new Bloodhound({
            name: "Theaters",
            datumTokenizer: function (d) {
              return Bloodhound.tokenizers.whitespace(d.name);
            },
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            local: theaterSearch,
            limit: 10
          });

          var museumsBH = new Bloodhound({
            name: "Museums",
            datumTokenizer: function (d) {
              return Bloodhound.tokenizers.whitespace(d.name);
            },
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            local: museumSearch,
            limit: 10
          });

          var geonamesBH = new Bloodhound({
            name: "GeoNames",
            datumTokenizer: function (d) {
              return Bloodhound.tokenizers.whitespace(d.name);
            },
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            remote: {
              url: "http://api.geonames.org/searchJSON?username=bootleaf&featureClass=P&maxRows=5&countryCode=US&name_startsWith=%QUERY",
              filter: function (data) {
                return $.map(data.geonames, function (result) {
                  return {
                    name: result.name + ", " + result.adminCode1,
                    lat: result.lat,
                    lng: result.lng,
                    source: "GeoNames"
                  };
                });
              },
              ajax: {
                beforeSend: function (jqXhr, settings) {
                  settings.url += "&east=" + map.getBounds().getEast() + "&west=" + map.getBounds().getWest() + "&north=" + map.getBounds().getNorth() + "&south=" + map.getBounds().getSouth();
                  $("#searchicon").removeClass("fa-search").addClass("fa-refresh fa-spin");
                },
                complete: function (jqXHR, status) {
                  $('#searchicon').removeClass("fa-refresh fa-spin").addClass("fa-search");
                }
              }
            },
            limit: 10
          });
          boroughsBH.initialize();
          theatersBH.initialize();
          museumsBH.initialize();
          geonamesBH.initialize();

          /* instantiate the typeahead UI */
          $("#searchbox").typeahead({
            minLength: 3,
            highlight: true,
            hint: false
          }, {
            name: "Boroughs",
            displayKey: "name",
            source: boroughsBH.ttAdapter(),
            templates: {
              header: "<h4 class='typeahead-header'>Boroughs</h4>"
            }
          }, {
            name: "Theaters",
            displayKey: "name",
            source: theatersBH.ttAdapter(),
            templates: {
              header: "<h4 class='typeahead-header'><img src='{% static "bootleaf_example/assets/img/theater.png" %}' width='24' height='28'>&nbsp;Theaters</h4>",
              suggestion: Handlebars.compile(["{{name}}<br>&nbsp;<small>{{address}}</small>"].join(""))
            }
          }, {
            name: "Museums",
            displayKey: "name",
            source: museumsBH.ttAdapter(),
            templates: {
              header: "<h4 class='typeahead-header'><img src='{% static "bootleaf_example/assets/img/museum.png" %}' width='24' height='28'>&nbsp;Museums</h4>",
              suggestion: Handlebars.compile(["{{name}}<br>&nbsp;<small>{{address}}</small>"].join(""))
            }
          }, {
            name: "GeoNames",
            displayKey: "name",
            source: geonamesBH.ttAdapter(),
            templates: {
              header: "<h4 class='typeahead-header'><img src='{% static "bootleaf_example/assets/img/globe.png" %}' width='25' height='25'>&nbsp;GeoNames</h4>"
            }
          }).on("typeahead:selected", function (obj, datum) {
            if (datum.source === "Boroughs") {
              map.fitBounds(datum.bounds);
            }
            if (datum.source === "Theaters") {
              if (!map.hasLayer(theaterLayer)) {
                map.addLayer(theaterLayer);
              }
              map.setView([datum.lat, datum.lng], 17);
              if (map._layers[datum.id]) {
                map._layers[datum.id].fire("click");
              }
            }
            if (datum.source === "Museums") {
              if (!map.hasLayer(museumLayer)) {
                map.addLayer(museumLayer);
              }
              map.setView([datum.lat, datum.lng], 17);
              if (map._layers[datum.id]) {
                map._layers[datum.id].fire("click");
              }
            }
            if (datum.source === "GeoNames") {
              map.setView([datum.lat, datum.lng], 14);
            }
            if ($(".navbar-collapse").height() > 50) {
              $(".navbar-collapse").collapse("hide");
            }
          }).on("typeahead:opened", function () {
            $(".navbar-collapse.in").css("max-height", $(document).height() - $(".navbar-header").height());
            $(".navbar-collapse.in").css("height", $(document).height() - $(".navbar-header").height());
          }).on("typeahead:closed", function () {
            $(".navbar-collapse.in").css("max-height", "");
            $(".navbar-collapse.in").css("height", "");
          });
          $(".twitter-typeahead").css("position", "static");
          $(".twitter-typeahead").css("display", "block");
        });

        // Leaflet patch to make layer control scrollable on touch browsers
        var container = $(".leaflet-control-layers")[0];
        if (!L.Browser.touch) {
          L.DomEvent
          .disableClickPropagation(container)
          .disableScrollPropagation(container);
        } else {
          L.DomEvent.disableClickPropagation(container);
        }
    });
    </script>
  </body>
</html>
