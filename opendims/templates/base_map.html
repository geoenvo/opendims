<!DOCTYPE html>

{% load staticfiles %}

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="yellow">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Open-DiMS</title>

    <link rel="stylesheet" href="{% static 'bootstrap/dist/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'font-awesome/css/font-awesome.min.css' %}">
    <link rel="stylesheet" href="{% static 'leaflet/leaflet.css' %}">
    <link rel="stylesheet" href="{% static 'bootleaf_example/assets/css/MarkerCluster.css' %}">
    <link rel="stylesheet" href="{% static 'bootleaf_example/assets/css/MarkerCluster.Default.css' %}">
    <link rel="stylesheet" href="{% static 'bootleaf_example/assets/css/L.Control.Locate.css' %}">
    <link rel="stylesheet" href="{% static 'bootleaf_example/assets/css/leaflet.groupedlayercontrol.css' %}">
    <link rel="stylesheet" href="{% static 'bootleaf_example/assets/css/app.css' %}">

    <link rel="apple-touch-icon" sizes="76x76" href="{% static 'bootleaf_example/assets/img/favicon-76.png' %}">
    <link rel="apple-touch-icon" sizes="120x120" href="{% static 'bootleaf_example/assets/img/favicon-120.png' %}">
    <link rel="apple-touch-icon" sizes="152x152" href="{% static 'bootleaf_example/assets/img/favicon-152.png' %}">
    <link rel="icon" sizes="196x196" href="{% static 'bootleaf_example/assets/img/favicon-196.png' %}">
    <link rel="icon" type="image/x-icon" href="{% static 'bootleaf_example/assets/img/favicon.ico' %}">
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <div class="navbar-icon-container">
            <a href="#" class="navbar-icon pull-right visible-xs" id="nav-btn"><i class="fa fa-bars fa-lg white"></i></a>
            <a href="#" class="navbar-icon pull-right visible-xs" id="sidebar-toggle-btn"><i class="fa fa-search fa-lg white"></i></a>
          </div>
          <a class="navbar-brand" href="#">Open-DiMS</a>
        </div>
        <div class="navbar-collapse collapse">
          <form class="navbar-form navbar-right" role="search">
            <div class="form-group has-feedback">
                <input id="searchbox" type="text" placeholder="Search" class="form-control">
                <span id="searchicon" class="fa fa-search form-control-feedback"></span>
            </div>
          </form>
          <ul class="nav navbar-nav">
            <li><a href="#" data-toggle="collapse" data-target=".navbar-collapse.in" id="about-btn"><i class="fa fa-question-circle white"></i>&nbsp;&nbsp;About</a></li>
            <li class="dropdown">
              <a id="toolsDrop" href="#" role="button" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-globe white"></i>&nbsp;&nbsp;Tools <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="#" data-toggle="collapse" data-target=".navbar-collapse.in" id="full-extent-btn"><i class="fa fa-arrows-alt"></i>&nbsp;&nbsp;Zoom To Full Extent</a></li>
                <li><a href="#" data-toggle="collapse" data-target=".navbar-collapse.in" id="legend-btn"><i class="fa fa-picture-o"></i>&nbsp;&nbsp;Show Legend</a></li>
                <li class="divider hidden-xs"></li>
                <li><a href="#" data-toggle="collapse" data-target=".navbar-collapse.in" id="login-btn"><i class="fa fa-user"></i>&nbsp;&nbsp;Login</a></li>
              </ul>
            </li>
            <li class="dropdown">
                <a class="dropdown-toggle" id="downloadDrop" href="#" role="button" data-toggle="dropdown"><i class="fa fa-cloud-download white"></i>&nbsp;&nbsp;Download Geojson Data <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="{% url 'reports:event_api' %}?disaster=ABR&format=json" download="ABR.geojson" target="_blank" data-toggle="collapse" data-target=".navbar-collapse.in"><i class="fa fa-download"></i>&nbsp;&nbsp;Data Abrasi</a></li>
                  <li><a href="{% url 'reports:event_api' %}?disaster=BJR&format=json" download="BJR.geojson" target="_blank" data-toggle="collapse" data-target=".navbar-collapse.in"><i class="fa fa-download"></i>&nbsp;&nbsp;Data Banjir</a></li>
                  <li><a href="{% url 'reports:event_api' %}?disaster=CEK&format=json" download="CEK.geojson" target="_blank" data-toggle="collapse" data-target=".navbar-collapse.in"><i class="fa fa-download"></i>&nbsp;&nbsp;Data Cuaca Kencang</a></li>
                  <li><a href="{% url 'reports:event_api' %}?disaster=GMP&format=json" download="GMP.geojson" target="_blank" data-toggle="collapse" data-target=".navbar-collapse.in"><i class="fa fa-download"></i>&nbsp;&nbsp;Data Gempa Bumi</a></li>
                  <li><a href="{% url 'reports:event_api' %}?disaster=KBK&format=json" download="KBK.geojson" target="_blank" data-toggle="collapse" data-target=".navbar-collapse.in"><i class="fa fa-download"></i>&nbsp;&nbsp;Data Kebakaran</a></li>
                  <li><a href="{% url 'reports:event_api' %}?disaster=LSR&format=json" download="LSR.geojson" target="_blank" data-toggle="collapse" data-target=".navbar-collapse.in"><i class="fa fa-download"></i>&nbsp;&nbsp;Data Longsor</a></li>
                  <li><a href="{% url 'reports:event_api' %}?disaster=LAI&format=json" download="LAI.geojson" target="_blank" data-toggle="collapse" data-target=".navbar-collapse.in"><i class="fa fa-download"></i>&nbsp;&nbsp;Data Lain-Lain</a></li>
                  <li><a href="{% url 'reports:event_api' %}?disaster=ROB&format=json" download="ROB.geojson" target="_blank" data-toggle="collapse" data-target=".navbar-collapse.in"><i class="fa fa-download"></i>&nbsp;&nbsp;Data Banjir Laut</a></li>
                  <li><a href="{% url 'reports:event_api' %}?disaster=SOS&format=json" download="SOS.geojson" target="_blank" data-toggle="collapse" data-target=".navbar-collapse.in"><i class="fa fa-download"></i>&nbsp;&nbsp;Data Tawuran</a></li>
                  <li><a href="{% url 'reports:event_api' %}?disaster=TER&format=json" download="TER.geojson" target="_blank" data-toggle="collapse" data-target=".navbar-collapse.in"><i class="fa fa-download"></i>&nbsp;&nbsp;Data Teror</a></li>
                  <li><a href="{% url 'reports:event_api' %}?disaster=TSU&format=json" download="TSU.geojson" target="_blank" data-toggle="collapse" data-target=".navbar-collapse.in"><i class="fa fa-download"></i>&nbsp;&nbsp;Data Tsunami</a></li>
                </ul>
            </li>
            <li class="hidden-xs"><a href="#" data-toggle="collapse" data-target=".navbar-collapse.in" id="list-btn"><i class="fa fa-list white"></i>&nbsp;&nbsp;Events List</a></li>
          </ul>
        </div><!--/.navbar-collapse -->
      </div>
    </div>

    <div id="container">
      <div id="sidebar">
        <div class="sidebar-wrapper">
          <div class="panel panel-default" id="features">
            <div class="panel-heading">
              <h3 class="panel-title">Events
              <button type="button" class="btn btn-xs btn-default pull-right" id="sidebar-hide-btn"><i class="fa fa-chevron-left"></i></button></h3>
            </div>
            <div class="panel-body">
              <div class="row">
                <div class="col-xs-8 col-md-8">
                  <input type="text" class="form-control search" placeholder="Filter" />
                </div>
                <div class="col-xs-4 col-md-4">
                  <button type="button" class="btn btn-primary pull-right sort" data-sort="feature-name" id="sort-btn"><i class="fa fa-sort"></i>&nbsp;&nbsp;Sort</button>
                </div>
              </div>
            </div>
            <div class="sidebar-table">
              <table class="table table-hover" id="feature-list">
                <thead class="hidden">
                  <tr>
                    <th>Icon</th>
                  <tr>
                  <tr>
                    <th>Name</th>
                  <tr>
                  <tr>
                    <th>Chevron</th>
                  <tr>
                </thead>
                <tbody class="list"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div id="map"></div>
    </div>
    <div id="loading">
      <div class="loading-indicator">
        <div class="progress progress-striped active">
          <div class="progress-bar progress-bar-info progress-bar-full"></div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="aboutModal" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <button class="close" type="button" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">Welcome to the Open-DiMS Dashboard</h4>
          </div>
          <div class="modal-body">
            <ul class="nav nav-tabs nav-justified" id="aboutTabs">
              <li class="active"><a href="#about" data-toggle="tab"><i class="fa fa-question-circle"></i>&nbsp;About the project</a></li>
              <li><a href="#contact" data-toggle="tab"><i class="fa fa-envelope"></i>&nbsp;Contact us</a></li>
              <li><a href="#disclaimer" data-toggle="tab"><i class="fa fa-exclamation-circle"></i>&nbsp;Disclaimer</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-globe"></i>&nbsp;Metadata <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="#boroughs-tab" data-toggle="tab">Boroughs</a></li>
                  <li><a href="#subway-lines-tab" data-toggle="tab">Subway Lines</a></li>
                  <li><a href="#theaters-tab" data-toggle="tab">Theaters</a></li>
                  <li><a href="#museums-tab" data-toggle="tab">Museums</a></li>
                </ul>
              </li>
            </ul>
            <div class="tab-content" id="aboutTabsContent">
              <div class="tab-pane fade active in" id="about">
                <p>A simple, responsive template for building web mapping applications with <a href="http://getbootstrap.com/">Bootstrap 3</a>, <a href="http://leafletjs.com/" target="_blank">Leaflet</a>, and <a href="http://twitter.github.io/typeahead.js/" target="_blank">typeahead.js</a>. Open source, MIT licensed, and available on <a href="https://github.com/bmcbride/bootleaf" target="_blank">GitHub</a>.</p>
                <div class="panel panel-primary">
                  <div class="panel-heading">Features</div>
                  <ul class="list-group">
                    <li class="list-group-item">Fullscreen mobile-friendly map template with responsive navbar and modal placeholders</li>
                    <li class="list-group-item">jQuery loading of external GeoJSON files</li>
                    <li class="list-group-item">Logical multiple layer marker clustering via the <a href="https://github.com/Leaflet/Leaflet.markercluster" target="_blank">leaflet marker cluster plugin</a></li>
                    <li class="list-group-item">Elegant client-side multi-layer feature search with autocomplete using <a href="http://twitter.github.io/typeahead.js/" target="_blank">typeahead.js</a></li>
                    <li class="list-group-item">Responsive sidebar feature list synced with map bounds, which includes sorting and filtering via <a href="http://listjs.com/" target="_blank">list.js</a></li>
                    <li class="list-group-item">Marker icons included in grouped layer control via the <a href="https://github.com/ismyrnow/Leaflet.groupedlayercontrol" target="_blank">grouped layer control plugin</a></li>
                  </ul>
                </div>
              </div>
              <div id="disclaimer" class="tab-pane fade text-danger">
                <p>The data provided on this site is for informational and planning purposes only.</p>
                <p>Absolutely no accuracy or completeness guarantee is implied or intended. All information on this map is subject to such variations and corrections as might result from a complete title search and/or accurate field survey.</p>
              </div>
              <div class="tab-pane fade" id="contact">
                <form id="contact-form">
                  <div class="well well-sm">
                    <div class="row">
                      <div class="col-md-4">
                        <div class="form-group">
                          <label for="first-name">First Name:</label>
                          <input type="text" class="form-control" id="first-name">
                        </div>
                        <div class="form-group">
                          <label for="last-name">Last Name:</label>
                          <input type="text" class="form-control" id="last-email">
                        </div>
                        <div class="form-group">
                          <label for="email">Email:</label>
                          <input type="text" class="form-control" id="email">
                        </div>
                      </div>
                      <div class="col-md-8">
                        <label for="message">Message:</label>
                        <textarea class="form-control" rows="8" id="message"></textarea>
                      </div>
                      <div class="col-md-12">
                        <p>
                          <button type="submit" class="btn btn-primary pull-right" data-dismiss="modal">Submit</button>
                        </p>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
              <div class="tab-pane fade" id="boroughs-tab">
                <p>Borough data courtesy of <a href="http://www.nyc.gov/html/dcp/pdf/bytes/nybbwi_metadata.pdf" target="_blank">New York City Department of City Planning</a></p>
              </div>
              <div class="tab-pane fade" id="subway-lines-tab">
                <p><a href="http://spatialityblog.com/2010/07/08/mta-gis-data-update/#datalinks" target="_blank">MTA Subway data</a> courtesy of the <a href="http://www.urbanresearch.org/about/cur-components/cuny-mapping-service" target="_blank">CUNY Mapping Service at the Center for Urban Research</a></p>
              </div>
              <div class="tab-pane fade" id="theaters-tab">
                <p>Theater data courtesy of <a href="https://data.cityofnewyork.us/Recreation/Theaters/kdu2-865w" target="_blank">NYC Department of Information & Telecommunications (DoITT)</a></p>
              </div>
              <div class="tab-pane fade" id="museums-tab">
                <p>Museum data courtesy of <a href="https://data.cityofnewyork.us/Recreation/Museums-and-Galleries/sat5-adpb" target="_blank">NYC Department of Information & Telecommunications (DoITT)</a></p>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="modal fade" id="legendModal" tabindex="-1" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">Map Legend</h4>
          </div>
          <div class="modal-body">
            <p>Map Legend goes here...</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="modal fade" id="loginModal" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">Login</h4>
          </div>
          <div class="modal-body">
            <form id="contact-form">
              <fieldset>
                <div class="form-group">
                  <label for="name">Username:</label>
                  <input type="text" class="form-control" id="username">
                </div>
                <div class="form-group">
                  <label for="email">Password:</label>
                  <input type="password" class="form-control" id="password">
                </div>
              </fieldset>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary" data-dismiss="modal">Login</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="modal fade" id="featureModal" tabindex="-1" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button class="close" type="button" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title text-primary" id="feature-title"></h4>
          </div>
          <div class="modal-body" id="feature-info"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="modal fade" id="attributionModal" tabindex="-1" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button class="close" type="button" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">
              Developed by <a href='http://bryanmcbride.com'>bryanmcbride.com</a>
            </h4>
          </div>
          <div class="modal-body">
            <div id="attribution"></div>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <script src="{% static 'jquery/dist/jquery.min.js' %}"></script>
    <script src="{% static 'bootstrap/dist/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'bootleaf_example/assets/js/typeahead.bundle.min.js' %}"></script>
    <script src="{% static 'bootleaf_example/assets/js/handlebars.min.js' %}"></script>
    <script src="{% static 'bootleaf_example/assets/js/list.min.js' %}"></script>
    <script src="{% static 'leaflet/leaflet.js' %}"></script>
    <script src="{% static 'bootleaf_example/assets/js/leaflet.markercluster.js' %}"></script>
    <script src="{% static 'bootleaf_example/assets/js/L.Control.Locate.min.js' %}"></script>
    <script src="{% static 'bootleaf_example/assets/js/leaflet.groupedlayercontrol.js' %}"></script>
    <!--
    <script src="{% static 'bootleaf_example/assets/js/app.js' %}"></script>
    -->
    <script type="text/javascript">
    $(document).ready(function(){
        var map, featureList, BJRSearch =[], KBKSearch = [], LAISearch = [], GMPSearch = [], CEKSearch = [], ROBSearch = [], ABRSearch = [], TSUSearch = [], SOSSearch = [], TERSearch = [], LSRSearch = [];

        $(window).resize(function() {
          sizeLayerControl();
        });

        $(document).on("click", ".feature-row", function(e) {
          $(document).off("mouseout", ".feature-row", clearHighlight);
          sidebarClick(parseInt($(this).attr("id"), 10));
        });

        if ( !("ontouchstart" in window) ) {
          $(document).on("mouseover", ".feature-row", function(e) {
            highlight.clearLayers().addLayer(L.circleMarker([$(this).attr("lat"), $(this).attr("lng")], highlightStyle));
          });
        }

        $(document).on("mouseout", ".feature-row", clearHighlight);

        $("#about-btn").click(function() {
          $("#aboutModal").modal("show");
          $(".navbar-collapse.in").collapse("hide");
          return false;
        });

        $("#full-extent-btn").click(function() {
          map.fitBounds(BJR.getBounds());
          $(".navbar-collapse.in").collapse("hide");
          return false;
        });

        $("#legend-btn").click(function() {
          $("#legendModal").modal("show");
          $(".navbar-collapse.in").collapse("hide");
          return false;
        });

        $("#login-btn").click(function() {
          $("#loginModal").modal("show");
          $(".navbar-collapse.in").collapse("hide");
          return false;
        });

        $("#list-btn").click(function() {
          $('#sidebar').toggle();
          map.invalidateSize();
          return false;
        });

        $("#nav-btn").click(function() {
          $(".navbar-collapse").collapse("toggle");
          return false;
        });

        $("#sidebar-toggle-btn").click(function() {
          $("#sidebar").toggle();
          map.invalidateSize();
          return false;
        });

        $("#sidebar-hide-btn").click(function() {
          $('#sidebar').hide();
          map.invalidateSize();
        });

        function sizeLayerControl() {
          $(".leaflet-control-layers").css("max-height", $("#map").height() - 50);
        }

        function clearHighlight() {
          highlight.clearLayers();
        }

        function sidebarClick(id) {
          var layer = markerClusters.getLayer(id);

          var center;
          var bounds;

          if (layer.feature.geometry.type === 'Point') {
            center = layer.getCenter();
          }
          else if (layer.feature.geometry.type === 'MultiPolygon') {
            bounds = layer.getBounds();
            center = bounds.getCenter();
          }

          map.setView([center.lat, center.lng], 17);

          layer.fire("click");
          /* Hide sidebar and go to the map on small screens */
          if (document.body.clientWidth <= 767) {
            $("#sidebar").hide();
            map.invalidateSize();
          }
        }
        // end sidebarClick()

        function syncSidebar() {
          /* Empty sidebar features */
          $("#feature-list tbody").empty();

          BJR.eachLayer(function (layer) {
            if (map.hasLayer(BJRLayer)) {
              var center;

              if (layer.feature.geometry.type === 'Point') {
                center = layer.getLatLng();
              }
              else if (layer.feature.geometry.type === 'MultiPolygon') {
                var bounds = layer.getBounds();
                center = bounds.getCenter();
              }

              if (map.getBounds().contains(center)) {
                if (layer.feature.properties) {
                  var featureName = layer.feature.properties.disaster;
                  var featureLocation = layer.feature.properties.province_name + ', ' + layer.feature.properties.city_name + ', ' + layer.feature.properties.subdistrict_name + ', ' + layer.feature.properties.village_name + ', ' + 'RW:' + layer.feature.properties.rw_name;
                  $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/flood.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                }
              }
            }
          });

          ABR.eachLayer(function (layer) {
            if (map.hasLayer(ABRLayer)) {
              var center;

              if (layer.feature.geometry.type === 'Point') {
                center = layer.getLatLng();
              }
              else if (layer.feature.geometry.type === 'MultiPolygon') {
                var bounds = layer.getBounds();
                center = bounds.getCenter();
              }

              if (map.getBounds().contains(center)) {
                if (layer.feature.properties) {
                  var featureName = layer.feature.properties.disaster;
                  var featureLocation = layer.feature.properties.province_name + ', ' + layer.feature.properties.city_name + ', ' + layer.feature.properties.subdistrict_name + ', ' + layer.feature.properties.village_name + ', ' + 'RW:' + layer.feature.properties.rw_name;
                  $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/abration.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                }
              }
            }
          });

          CEK.eachLayer(function (layer) {
            if (map.hasLayer(CEKLayer)) {
              var center;

              if (layer.feature.geometry.type === 'Point') {
                center = layer.getLatLng();
              }
              else if (layer.feature.geometry.type === 'MultiPolygon') {
                var bounds = layer.getBounds();
                center = bounds.getCenter();
              }

              if (map.getBounds().contains(center)) {
                if (layer.feature.properties) {
                  var featureName = layer.feature.properties.disaster;
                  var featureLocation = layer.feature.properties.province_name + ', ' + layer.feature.properties.city_name + ', ' + layer.feature.properties.subdistrict_name + ', ' + layer.feature.properties.village_name + ', ' + 'RW:' + layer.feature.properties.rw_name;
                  $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/tornado.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                }
              }
            }
          });

          LAI.eachLayer(function (layer) {
            if (map.hasLayer(LAILayer)) {
              var center;

              if (layer.feature.geometry.type === 'Point') {
                center = layer.getLatLng();
              }
              else if (layer.feature.geometry.type === 'MultiPolygon') {
                var bounds = layer.getBounds();
                center = bounds.getCenter();
              }

              if (map.getBounds().contains(center)) {
                if (layer.feature.properties) {
                  var featureName = layer.feature.properties.disaster;
                  var featureLocation = layer.feature.properties.province_name + ', ' + layer.feature.properties.city_name + ', ' + layer.feature.properties.subdistrict_name + ', ' + layer.feature.properties.village_name + ', ' + 'RW:' + layer.feature.properties.rw_name;
                  $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/treedown.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                }
              }
            }
          });

          ROB.eachLayer(function (layer) {
            if (map.hasLayer(ROBLayer)) {
              var center;

              if (layer.feature.geometry.type === 'Point') {
                center = layer.getLatLng();
              }
              else if (layer.feature.geometry.type === 'MultiPolygon') {
                var bounds = layer.getBounds();
                center = bounds.getCenter();
              }

              if (map.getBounds().contains(center)) {
                if (layer.feature.properties) {
                  var featureName = layer.feature.properties.disaster;
                  var featureLocation = layer.feature.properties.province_name + ', ' + layer.feature.properties.city_name + ', ' + layer.feature.properties.subdistrict_name + ', ' + layer.feature.properties.village_name + ', ' + 'RW:' + layer.feature.properties.rw_name;
                  $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/seaflood.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                }
              }
            }
          });

          GMP.eachLayer(function (layer) {
            if (map.hasLayer(GMPLayer)) {
              var center;

              if (layer.feature.geometry.type === 'Point') {
                center = layer.getLatLng();
              }
              else if (layer.feature.geometry.type === 'MultiPolygon') {
                var bounds = layer.getBounds();
                center = bounds.getCenter();
              }

              if (map.getBounds().contains(center)) {
                if (layer.feature.properties) {
                  var featureName = layer.feature.properties.disaster;
                  var featureLocation = layer.feature.properties.province_name + ', ' + layer.feature.properties.city_name + ', ' + layer.feature.properties.subdistrict_name + ', ' + layer.feature.properties.village_name + ', ' + 'RW:' + layer.feature.properties.rw_name;
                  $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/earthquake.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                }
              }
            }
          });

          SOS.eachLayer(function (layer) {
            if (map.hasLayer(SOSLayer)) {
              var center;

              if (layer.feature.geometry.type === 'Point') {
                center = layer.getLatLng();
              }
              else if (layer.feature.geometry.type === 'MultiPolygon') {
                var bounds = layer.getBounds();
                center = bounds.getCenter();
              }

              if (map.getBounds().contains(center)) {
                if (layer.feature.properties) {
                  var featureName = layer.feature.properties.disaster;
                  var featureLocation = layer.feature.properties.province_name + ', ' + layer.feature.properties.city_name + ', ' + layer.feature.properties.subdistrict_name + ', ' + layer.feature.properties.village_name + ', ' + 'RW:' + layer.feature.properties.rw_name;
                  $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/strike.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                }
              }
            }
          });

          TSU.eachLayer(function (layer) {
            if (map.hasLayer(TSULayer)) {
              var center;

              if (layer.feature.geometry.type === 'Point') {
                center = layer.getLatLng();
              }
              else if (layer.feature.geometry.type === 'MultiPolygon') {
                var bounds = layer.getBounds();
                center = bounds.getCenter();
              }

              if (map.getBounds().contains(center)) {
                if (layer.feature.properties) {
                  var featureName = layer.feature.properties.disaster;
                  var featureLocation = layer.feature.properties.province_name + ', ' + layer.feature.properties.city_name + ', ' + layer.feature.properties.subdistrict_name + ', ' + layer.feature.properties.village_name + ', ' + 'RW:' + layer.feature.properties.rw_name;
                  $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/tsunami.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                }
              }
            }
          });

          KBK.eachLayer(function (layer) {
            if (map.hasLayer(KBKLayer)) {
              var center;

              if (layer.feature.geometry.type === 'Point') {
                center = layer.getLatLng();
              }
              else if (layer.feature.geometry.type === 'MultiPolygon') {
                var bounds = layer.getBounds();
                center = bounds.getCenter();
              }

              if (map.getBounds().contains(center)) {
                if (layer.feature.properties) {
                  var featureName = layer.feature.properties.disaster;
                  var featureLocation = layer.feature.properties.province_name + ', ' + layer.feature.properties.city_name + ', ' + layer.feature.properties.subdistrict_name + ', ' + layer.feature.properties.village_name + ', ' + 'RW:' + layer.feature.properties.rw_name;
                  $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/fire.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                }
              }
            }
          });

          TER.eachLayer(function (layer) {
            if (map.hasLayer(TERLayer)) {
              var center;

              if (layer.feature.geometry.type === 'Point') {
                center = layer.getLatLng();
              }
              else if (layer.feature.geometry.type === 'MultiPolygon') {
                var bounds = layer.getBounds();
                center = bounds.getCenter();
              }

              if (map.getBounds().contains(center)) {
                if (layer.feature.properties) {
                  var featureName = layer.feature.properties.disaster;
                  var featureLocation = layer.feature.properties.province_name + ', ' + layer.feature.properties.city_name + ', ' + layer.feature.properties.subdistrict_name + ', ' + layer.feature.properties.village_name + ', ' + 'RW:' + layer.feature.properties.rw_name;
                  $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/shooting.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                }
              }
            }
          });

          LSR.eachLayer(function (layer) {
            if (map.hasLayer(LSRLayer)) {
              var center;

              if (layer.feature.geometry.type === 'Point') {
                center = layer.getLatLng();
              }
              else if (layer.feature.geometry.type === 'MultiPolygon') {
                var bounds = layer.getBounds();
                center = bounds.getCenter();
              }

              if (map.getBounds().contains(center)) {
                if (layer.feature.properties) {
                  var featureName = layer.feature.properties.disaster;
                  var featureLocation = layer.feature.properties.province_name + ', ' + layer.feature.properties.city_name + ', ' + layer.feature.properties.subdistrict_name + ', ' + layer.feature.properties.village_name + ', ' + 'RW:' + layer.feature.properties.rw_name;
                  $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/avalanche.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                }
              }
            }
          });
          featureList = new List("features", {
            valueNames: ["feature-name"]
          });
          featureList.sort("feature-name", {
            order: "asc"
          });
        }
        // end syncSidebar()

        /* Basemap Layers */
        var mapquestOSM = L.tileLayer("https://{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png", {
          maxZoom: 19,
          subdomains: ["otile1-s", "otile2-s", "otile3-s", "otile4-s"],
          attribution: 'Tiles courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="https://developer.mapquest.com/content/osm/mq_logo.png">. Map data (c) <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors, CC-BY-SA.'
        });
        var mapquestOAM = L.tileLayer("https://{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.jpg", {
          maxZoom: 18,
          subdomains: ["otile1-s", "otile2-s", "otile3-s", "otile4-s"],
          attribution: 'Tiles courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a>. Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency'
        });
        var mapquestHYB = L.layerGroup([L.tileLayer("https://{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.jpg", {
          maxZoom: 18,
          subdomains: ["otile1-s", "otile2-s", "otile3-s", "otile4-s"]
        }), L.tileLayer("https://{s}.mqcdn.com/tiles/1.0.0/hyb/{z}/{x}/{y}.png", {
          maxZoom: 19,
          subdomains: ["otile1-s", "otile2-s", "otile3-s", "otile4-s"],
          attribution: 'Labels courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="https://developer.mapquest.com/content/osm/mq_logo.png">. Map data (c) <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors, CC-BY-SA. Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency'
        })]);

        /* Overlay Layers */
        var highlight = L.geoJson(null);
        var highlightStyle = {
          stroke: false,
          fillColor: "#00FFFF",
          fillOpacity: 0.7,
          radius: 10
        };

        /* Single marker cluster layer to hold all clusters */
        var markerClusters = new L.MarkerClusterGroup({
          spiderfyOnMaxZoom: true,
          showCoverageOnHover: false,
          zoomToBoundsOnClick: true,
          disableClusteringAtZoom: 16
        });

        //popupContent as global variable
        var popupContent = '';

        var LAILayer = L.geoJson(null);
        var LAI = L.geoJson(null, {
          style: function (feature) {
            return {
              color: 'blue',
              fill: true,
              opacity: 1,
              clickable: true
            };
          },
          onEachFeature: function (feature, layer) {
            var center;

            if (feature.geometry.type === 'MultiPolygon') {
              // Get bounds and center of polygon
              var bounds = layer.getBounds();
              center = bounds.getCenter();
            }
            else if (feature.geometry.type === 'Point') {
              center = layer.getLatLng();
            }

            if (feature.properties) {
              var featureName = feature.properties.disaster + '-' + feature.properties.created;
              var featureLocation = feature.properties.province_name + ', ' + feature.properties.city_name + ', ' + feature.properties.subdistrict_name + ', ' + feature.properties.village_name + ', ' + feature.properties.rw_name;
              popupContent = featureName + ': ' + featureLocation;

              $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/flood.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');

              LAISearch.push({
                name: featureName,
                location: featureLocation,
                source: 'LAI',
                id: L.stamp(layer),
                lat: center.lat,
                lng: center.lng
              });
            }

            // Use center to put a fixed marker on map
            var marker = L.marker(center, {
              icon: L.icon({
                iconUrl: "{% static 'img/markers/treedown.png' %}",
                iconSize: [24, 28],
                iconAnchor: [12, 28],
                popupAnchor: [0, -25]
              }),
              title: popupContent,
              riseOnHover: true
            }).addTo(map);

            var content = "<table class='table table-striped table-bordered table-condensed'>" +
              "<tr><th>Event</th><td>" + featureName + "</td></tr>" +
              "<tr><th>Name</th><td>" + feature.properties.disaster_note + "</td></tr>" +
              "<tr><th>Location</th><td>" + featureLocation + "</td></tr>" +
              "<tr><th>Report</th><td>" + feature.properties.reports + "</td></tr>" +
              "<tr><th>Detail</th><td><a class='url-break' href='" + "{% url "reports:event_list" %}" + feature.id + "' target='_blank'>" + 'View Detail' + "</a></td></tr>" + "<table>";

            layer.on({
              click: function (e) {
                $("#feature-title").html(feature.properties.disaster + '-' + feature.properties.created);
                $("#feature-info").html(content);
                $("#featureModal").modal("show");
                highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
              }
            });

            marker.on({
              click: function (e) {
                $("#feature-title").html(feature.properties.disaster + '-' + feature.properties.created);
                $("#feature-info").html(content);
                $("#featureModal").modal("show");
                highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
              }
            });
          },
        });
        $.getJSON("{% url "reports:event_api" %}?disaster=LAI&format=json", function (data) {
          LAI.addData(data);
        });

        var TERLayer = L.geoJson(null);
        var TER = L.geoJson(null, {
            style: function (feature) {
            return {
                color: 'blue',
                fill: true,
                opacity: 1,
                clickable: true
                };
            },
        onEachFeature: function (feature, layer) {
            var center;
            //Do looping for reports object

            var report =[];

            var reports = feature.properties.reports;

            for (var i= 0; i < reports.length; i++)
            {
                report = reports[i];
            }

            if (feature.geometry.type === 'MultiPolygon') {
                // Get bounds and center of polygon
                var bounds = layer.getBounds();
                center = bounds.getCenter();
                }
            else if (feature.geometry.type === 'Point') {
                center = layer.getLatLng();
                }
            if (feature.properties) {
                var featureName = feature.properties.disaster + '-' + feature.properties.created;
                var featureLocation = feature.properties.province_name + ', ' + feature.properties.city_name + ', ' + feature.properties.subdistrict_name + ', ' + feature.properties.village_name + ', ' + feature.properties.rw_name;
                popupContent = featureName + ': ' + featureLocation;
                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/flood.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                TERSearch.push({
                    name: featureName,
                    location: featureLocation,
                    source: 'TER',
                    id: L.stamp(layer),
                    lat: center.lat,
                    lng: center.lng
                    });
                }
            var marker = L.marker(center, {
                icon: L.icon({
                    iconUrl: "{% static 'img/markers/shooting.png' %}",
                    iconSize: [24, 28],
                    iconAnchor: [12, 28],
                    popupAnchor: [0, -25]
                }),
                title: popupContent,
                riseOnHover: true
            }).addTo(map);

            var content = "<table class='table table-striped table-bordered table-condensed'>" +
                          "<tr><th>Created</th><td>" + feature.properties.created + "</td></tr>" +
                          "<tr><th>Disaster</th><td>" + feature.properties.disaster_note+ "</td></tr>" +
                          "<tr><th>Province</th><td><a class='url-break' href='" + "{% url "geolevels:province_list" %}" + feature.properties.province + "' target='_blank'>" + feature.properties.province_name  + "</a></td></tr>" +
                          "<tr><th>City</th><td><a class='url-break' href='" + '/geolevels/city/' + feature.properties.city + "' target='_blank'>" + feature.properties.city_name  + "</a></td></tr>" +
                          "<tr><th>Subdistrict</th><td><a class='url-break' href='" + '/geolevels/subdistrict/' + feature.properties.subdistrict + "' target='_blank'>" + feature.properties.subdistrict_name  + "</a></td></tr>" +
                          "<tr><th>Village</th><td><a class='url-break' href='" + '/geolevels/village/' + feature.properties.village + "' target='_blank'>" + feature.properties.village_name  + "</a></td></tr>" +
                          "<tr><th>Rw</th><td><a class='url-break' href='" + '/geolevels/rw/' + feature.properties.rw + "' target='_blank'>" + feature.properties.rw_name  + "</a></td></tr>" +
                          "<tr><th>Detail</th><td><a class='url-break' href='" + "{% url "reports:event_list" %}" + feature.id + "' target='_blank'>" + 'View event detail' + "</a></td></tr>" +
                          "<tr><th>Report</th><td><a class='url-break' href='" + "{% url "reports:report_list" %}" + report.id + "' target='_blank'>" + 'View report detail' + "</a></td></tr>" +
                          "<table>";

            layer.on({
                click: function (e) {
                    $("#feature-title").html(featureName);
                    $("#feature-info").html(content);
                    $("#featureModal").modal("show");
                    highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                    }
                });

            marker.on({
                click: function (e) {
                    $("#feature-title").html(featureName);
                    $("#feature-info").html(content);
                    $("#featureModal").modal("show");
                    highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                }
            });

            },
        });
        $.getJSON("{% url "reports:event_api" %}?disaster=TER&format=json", function (data) {
        TER.addData(data);
        });

        var ABRLayer = L.geoJson(null);
        var ABR = L.geoJson(null, {
            style: function (feature) {
            return {
                color: 'blue',
                fill: true,
                opacity: 1,
                clickable: true
                };
            },
        onEachFeature: function (feature, layer) {
            var center;
            //Do looping for reports object

            var report =[];

            var reports = feature.properties.reports;

            for (var i= 0; i < reports.length; i++)
            {
                report = reports[i];
            }

            if (feature.geometry.type === 'MultiPolygon') {
                // Get bounds and center of polygon
                var bounds = layer.getBounds();
                center = bounds.getCenter();
                }
            else if (feature.geometry.type === 'Point') {
                center = layer.getLatLng();
                }

            if (feature.properties) {
                var featureName = feature.properties.disaster + '-' + feature.properties.created;
                var featureLocation = feature.properties.province_name + ', ' + feature.properties.city_name + ', ' + feature.properties.subdistrict_name + ', ' + feature.properties.village_name + ', ' + feature.properties.rw_name;
                popupContent = featureName + ': ' + featureLocation;

                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/flood.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');

                ABRSearch.push({
                    name: featureName,
                    location: featureLocation,
                    source: 'ABR',
                    id: L.stamp(layer),
                    lat: center.lat,
                    lng: center.lng
                    });
                }

                // Use center to put a fixed marker on map
                var marker = L.marker(center, {
                    icon: L.icon({
                        iconUrl: "{% static 'img/markers/abration.png' %}",
                        iconSize: [24, 28],
                        iconAnchor: [12, 28],
                        popupAnchor: [0, -25]
                    }),
                    title: popupContent,
                    riseOnHover: true
                }).addTo(map);

                var content = "<table class='table table-striped table-bordered table-condensed'>" +
                              "<tr><th>Created</th><td>" + feature.properties.created + "</td></tr>" +
                              "<tr><th>Disaster</th><td>" + feature.properties.disaster_note+ "</td></tr>" +
                              "<tr><th>Province</th><td><a class='url-break' href='" + "{% url "geolevels:province_list" %}" + feature.properties.province + "' target='_blank'>" + feature.properties.province_name  + "</a></td></tr>" +
                              "<tr><th>City</th><td><a class='url-break' href='" + '/geolevels/city/' + feature.properties.city + "' target='_blank'>" + feature.properties.city_name  + "</a></td></tr>" +
                              "<tr><th>Subdistrict</th><td><a class='url-break' href='" + '/geolevels/subdistrict/' + feature.properties.subdistrict + "' target='_blank'>" + feature.properties.subdistrict_name  + "</a></td></tr>" +
                              "<tr><th>Village</th><td><a class='url-break' href='" + '/geolevels/village/' + feature.properties.village + "' target='_blank'>" + feature.properties.village_name  + "</a></td></tr>" +
                              "<tr><th>Rw</th><td><a class='url-break' href='" + '/geolevels/rw/' + feature.properties.rw + "' target='_blank'>" + feature.properties.rw_name  + "</a></td></tr>" +
                              "<tr><th>Detail</th><td><a class='url-break' href='" + "{% url "reports:event_list" %}" + feature.id + "' target='_blank'>" + 'View event detail' + "</a></td></tr>" +
                              "<tr><th>Report</th><td><a class='url-break' href='" + "{% url "reports:report_list" %}" + report.id + "' target='_blank'>" + 'View report detail' + "</a></td></tr>" +
                              "<table>";

                layer.on({
                    click: function (e) {
                        $("#feature-title").html(featureName);
                        $("#feature-info").html(content);
                        $("#featureModal").modal("show");
                        highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                        }
                    });

                marker.on({
                    click: function (e) {
                        $("#feature-title").html(featureName);
                        $("#feature-info").html(content);
                        $("#featureModal").modal("show");
                        highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                    }
                });

                },
            });
            $.getJSON("{% url "reports:event_api" %}?disaster=ABR&format=json", function (data) {
            ABR.addData(data);
            });

        var TSULayer = L.geoJson(null);
        var TSU = L.geoJson(null, {
            style: function (feature) {
            return {
                color: 'blue',
                fill: true,
                opacity: 1,
                clickable: true
                };
            },
        onEachFeature: function (feature, layer) {
            var center;
            //Do looping for reports object

            var report =[];

            var reports = feature.properties.reports;

            for (var i= 0; i < reports.length; i++)
            {
                report = reports[i];
            }

            if (feature.geometry.type === 'MultiPolygon') {
                // Get bounds and center of polygon
                var bounds = layer.getBounds();
                center = bounds.getCenter();
                }
            else if (feature.geometry.type === 'Point') {
                center = layer.getLatLng();
                }

            if (feature.properties) {
                var featureName = feature.properties.disaster + '-' + feature.properties.created;
                var featureLocation = feature.properties.province_name + ', ' + feature.properties.city_name + ', ' + feature.properties.subdistrict_name + ', ' + feature.properties.village_name + ', ' + feature.properties.rw_name;
                popupContent = featureName + ': ' + featureLocation;
                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/flood.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                TSUSearch.push({
                    name: featureName,
                    location: featureLocation,
                    source: 'TSU',
                    id: L.stamp(layer),
                    lat: center.lat,
                    lng: center.lng
                    });
                }

                // Use center to put a fixed marker on map
                var marker = L.marker(center, {
                    icon: L.icon({
                        iconUrl: "{% static 'img/markers/tsunami.png' %}",
                        iconSize: [24, 28],
                        iconAnchor: [12, 28],
                        popupAnchor: [0, -25]
                    }),
                    title: popupContent,
                    riseOnHover: true
                }).addTo(map);

                var content = "<table class='table table-striped table-bordered table-condensed'>" +
                              "<tr><th>Created</th><td>" + feature.properties.created + "</td></tr>" +
                              "<tr><th>Disaster</th><td>" + feature.properties.disaster_note+ "</td></tr>" +
                              "<tr><th>Height</th><td>" + feature.properties.height+ "</td></tr>" +
                              "<tr><th>Province</th><td><a class='url-break' href='" + "{% url "geolevels:province_list" %}" + feature.properties.province + "' target='_blank'>" + feature.properties.province_name  + "</a></td></tr>" +
                              "<tr><th>City</th><td><a class='url-break' href='" + '/geolevels/city/' + feature.properties.city + "' target='_blank'>" + feature.properties.city_name  + "</a></td></tr>" +
                              "<tr><th>Subdistrict</th><td><a class='url-break' href='" + '/geolevels/subdistrict/' + feature.properties.subdistrict + "' target='_blank'>" + feature.properties.subdistrict_name  + "</a></td></tr>" +
                              "<tr><th>Village</th><td><a class='url-break' href='" + '/geolevels/village/' + feature.properties.village + "' target='_blank'>" + feature.properties.village_name  + "</a></td></tr>" +
                              "<tr><th>Rw</th><td><a class='url-break' href='" + '/geolevels/rw/' + feature.properties.rw + "' target='_blank'>" + feature.properties.rw_name  + "</a></td></tr>" +
                              "<tr><th>Detail</th><td><a class='url-break' href='" + "{% url "reports:event_list" %}" + feature.id + "' target='_blank'>" + 'View event detail' + "</a></td></tr>" +
                              "<tr><th>Report</th><td><a class='url-break' href='" + "{% url "reports:report_list" %}" + report.id + "' target='_blank'>" + 'View report detail' + "</a></td></tr>" +
                              "<table>";

                layer.on({
                    click: function (e) {
                        $("#feature-title").html(featureName);
                        $("#feature-info").html(content);
                        $("#featureModal").modal("show");
                        highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                        }
                    });

                marker.on({
                    click: function (e) {
                        $("#feature-title").html(featureName);
                        $("#feature-info").html(content);
                        $("#featureModal").modal("show");
                        highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                    }
                });
                },
            });
            $.getJSON("{% url "reports:event_api" %}?disaster=TSU&format=json", function (data) {
            TSU.addData(data);
            });

        var ROBLayer = L.geoJson(null);
        var ROB = L.geoJson(null, {
            style: function (feature) {
            return {
                color: 'blue',
                fill: true,
                opacity: 1,
                clickable: true
                };
            },
        onEachFeature: function (feature, layer) {
            var center;
            //Do looping for reports object

            var report =[];

            var reports = feature.properties.reports;

            for (var i= 0; i < reports.length; i++)
            {
                report = reports[i];
            }

            if (feature.geometry.type === 'MultiPolygon') {
                // Get bounds and center of polygon
                var bounds = layer.getBounds();
                center = bounds.getCenter();
                }
            else if (feature.geometry.type === 'Point') {
                center = layer.getLatLng();
                }

            if (feature.properties) {
                var featureName = feature.properties.disaster + '-' + feature.properties.created;
                var featureLocation = feature.properties.province_name + ', ' + feature.properties.city_name + ', ' + feature.properties.subdistrict_name + ', ' + feature.properties.village_name + ', ' + feature.properties.rw_name;
                popupContent = featureName + ': ' + featureLocation;

                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/flood.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');

                ROBSearch.push({
                    name: featureName,
                    location: featureLocation,
                    source: 'ROB',
                    id: L.stamp(layer),
                    lat: center.lat,
                    lng: center.lng
                    });
                }

                var marker = L.marker(center, {
                    icon: L.icon({
                        iconUrl: "{% static 'img/markers/seaflood.png' %}",
                        iconSize: [24, 28],
                        iconAnchor: [12, 28],
                        popupAnchor: [0, -25]
                    }),
                    title: popupContent,
                    riseOnHover: true
                }).addTo(map);

                var content = "<table class='table table-striped table-bordered table-condensed'>" +
                              "<tr><th>Created</th><td>" + feature.properties.created + "</td></tr>" +
                              "<tr><th>Disaster</th><td>" + feature.properties.disaster_note+ "</td></tr>" +
                              "<tr><th>Height</th><td>" + feature.properties.height+ "</td></tr>" +
                              "<tr><th>Province</th><td><a class='url-break' href='" + "{% url "geolevels:province_list" %}" + feature.properties.province + "' target='_blank'>" + feature.properties.province_name  + "</a></td></tr>" +
                              "<tr><th>City</th><td><a class='url-break' href='" + '/geolevels/city/' + feature.properties.city + "' target='_blank'>" + feature.properties.city_name  + "</a></td></tr>" +
                              "<tr><th>Subdistrict</th><td><a class='url-break' href='" + '/geolevels/subdistrict/' + feature.properties.subdistrict + "' target='_blank'>" + feature.properties.subdistrict_name  + "</a></td></tr>" +
                              "<tr><th>Village</th><td><a class='url-break' href='" + '/geolevels/village/' + feature.properties.village + "' target='_blank'>" + feature.properties.village_name  + "</a></td></tr>" +
                              "<tr><th>Rw</th><td><a class='url-break' href='" + '/geolevels/rw/' + feature.properties.rw + "' target='_blank'>" + feature.properties.rw_name  + "</a></td></tr>" +
                              "<tr><th>Detail</th><td><a class='url-break' href='" + "{% url "reports:event_list" %}" + feature.id + "' target='_blank'>" + 'View event detail' + "</a></td></tr>" +
                              "<tr><th>Report</th><td><a class='url-break' href='" + "{% url "reports:report_list" %}" + report.id + "' target='_blank'>" + 'View report detail' + "</a></td></tr>" +
                              "<table>";

                layer.on({
                    click: function (e) {
                        $("#feature-title").html(featureName);
                        $("#feature-info").html(content);
                        $("#featureModal").modal("show");
                        highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                        }
                    });

                marker.on({
                    click: function (e) {
                        $("#feature-title").html(featureName);
                        $("#feature-info").html(content);
                        $("#featureModal").modal("show");
                        highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                    }
                });
                },
            });
            $.getJSON("{% url "reports:event_api" %}?disaster=ROB&format=json", function (data) {
            ROB.addData(data);
            });

        var SOSLayer = L.geoJson(null);
        var SOS = L.geoJson(null, {
            style: function (feature) {
            return {
                color: 'blue',
                fill: true,
                opacity: 1,
                clickable: true
                };
            },
            onEachFeature: function (feature, layer) {
            var center;

            //Do looping for reports object
            var report =[];

            var reports = feature.properties.reports;

            for (var i= 0; i < reports.length; i++)
            {
                report = reports[i];
                consle.log(report)
            }

            if (feature.geometry.type === 'MultiPolygon') {
                // Get bounds and center of polygon
                var bounds = layer.getBounds();
                center = bounds.getCenter();
                }
            else if (feature.geometry.type === 'Point') {
                center = layer.getLatLng();
                }

            if (feature.properties) {
                var featureName = feature.properties.disaster + '-' + feature.properties.created;
                var featureLocation = feature.properties.province_name + ', ' + feature.properties.city_name + ', ' + feature.properties.subdistrict_name + ', ' + feature.properties.village_name + ', ' + feature.properties.rw_name;
                popupContent = featureName + ': ' + featureLocation;

                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/flood.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');

                SOSSearch.push({
                    name: featureName,
                    location: featureLocation,
                    source: 'SOS',
                    id: L.stamp(layer),
                    lat: center.lat,
                    lng: center.lng
                    });
                }

                // Use center to put a fixed marker on map
            var marker = L.marker(center, {
                icon: L.icon({
                    iconUrl: "{% static 'img/markers/strike.png' %}",
                    iconSize: [24, 28],
                    iconAnchor: [12, 28],
                    popupAnchor: [0, -25]
                }),
                title: popupContent,
                riseOnHover: true
            }).addTo(map);

            var content = "<table class='table table-striped table-bordered table-condensed'>" +
                          "<tr><th>Created</th><td>" + feature.properties.created + "</td></tr>" +
                          "<tr><th>Disaster</th><td>" + feature.properties.disaster_note+ "</td></tr>" +
                          "<tr><th>Province</th><td><a class='url-break' href='" + "{% url "geolevels:province_list" %}" + feature.properties.province + "' target='_blank'>" + feature.properties.province_name  + "</a></td></tr>" +
                          "<tr><th>City</th><td><a class='url-break' href='" + '/geolevels/city/' + feature.properties.city + "' target='_blank'>" + feature.properties.city_name  + "</a></td></tr>" +
                          "<tr><th>Subdistrict</th><td><a class='url-break' href='" + '/geolevels/subdistrict/' + feature.properties.subdistrict + "' target='_blank'>" + feature.properties.subdistrict_name  + "</a></td></tr>" +
                          "<tr><th>Village</th><td><a class='url-break' href='" + '/geolevels/village/' + feature.properties.village + "' target='_blank'>" + feature.properties.village_name  + "</a></td></tr>" +
                          "<tr><th>Rw</th><td><a class='url-break' href='" + '/geolevels/rw/' + feature.properties.rw + "' target='_blank'>" + feature.properties.rw_name  + "</a></td></tr>" +
                          "<tr><th>Detail</th><td><a class='url-break' href='" + "{% url "reports:event_list" %}" + feature.id + "' target='_blank'>" + 'View event detail' + "</a></td></tr>" +
                          "<tr><th>Report</th><td><a class='url-break' href='" + "{% url "reports:report_list" %}" + report.id + "' target='_blank'>" + 'View report detail' + "</a></td></tr>" +
                          "<table>";

            layer.on({
                click: function (e) {
                    $("#feature-title").html(featureName);
                    $("#feature-info").html(content);
                    $("#featureModal").modal("show");
                    highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                    }
                });

            marker.on({
                click: function (e) {
                    $("#feature-title").html(featureName);
                    $("#feature-info").html(content);
                    $("#featureModal").modal("show");
                    highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                }
            });
        },
        });
        $.getJSON("{% url "reports:event_api" %}?disaster=SOS&format=json", function (data) {
        SOS.addData(data);
        });

        var CEKLayer = L.geoJson(null);
        var CEK = L.geoJson(null, {
            style: function (feature) {
            return {
                color: 'blue',
                fill: true,
                opacity: 1,
                clickable: true
                };
            },
            onEachFeature: function (feature, layer) {
            var center;
            //Do looping for reports object
            var report =[];

            var reports = feature.properties.reports;

            for (var i= 0; i < reports.length; i++)
            {
                report = reports[i];
            }

            if (feature.geometry.type === 'MultiPolygon') {
                // Get bounds and center of polygon
                var bounds = layer.getBounds();
                center = bounds.getCenter();
                }
            else if (feature.geometry.type === 'Point') {
                center = layer.getLatLng();
                }

            if (feature.properties) {
                var featureName = feature.properties.disaster + '-' + feature.properties.created;
                var featureLocation = feature.properties.province_name + ', ' + feature.properties.city_name + ', ' + feature.properties.subdistrict_name + ', ' + feature.properties.village_name + ', ' + feature.properties.rw_name;
                popupContent = featureName + ': ' + featureLocation;

                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/flood.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');

                CEKSearch.push({
                    name: featureName,
                    location: featureLocation,
                    source: 'CEK',
                    id: L.stamp(layer),
                    lat: center.lat,
                    lng: center.lng
                    });
                }

                // Use center to put a fixed marker on map
                var marker = L.marker(center, {
                    icon: L.icon({
                        iconUrl: "{% static 'img/markers/tornado.png' %}",
                        iconSize: [24, 28],
                        iconAnchor: [12, 28],
                        popupAnchor: [0, -25]
                    }),
                    title: popupContent,
                    riseOnHover: true
                }).addTo(map);

                var content = "<table class='table table-striped table-bordered table-condensed'>" +
                              "<tr><th>Created</th><td>" + feature.properties.created + "</td></tr>" +
                              "<tr><th>Disaster</th><td>" + feature.properties.disaster_note+ "</td></tr>" +
                              "<tr><th>Province</th><td><a class='url-break' href='" + "{% url "geolevels:province_list" %}" + feature.properties.province + "' target='_blank'>" + feature.properties.province_name  + "</a></td></tr>" +
                              "<tr><th>City</th><td><a class='url-break' href='" + '/geolevels/city/' + feature.properties.city + "' target='_blank'>" + feature.properties.city_name  + "</a></td></tr>" +
                              "<tr><th>Subdistrict</th><td><a class='url-break' href='" + '/geolevels/subdistrict/' + feature.properties.subdistrict + "' target='_blank'>" + feature.properties.subdistrict_name  + "</a></td></tr>" +
                              "<tr><th>Village</th><td><a class='url-break' href='" + '/geolevels/village/' + feature.properties.village + "' target='_blank'>" + feature.properties.village_name  + "</a></td></tr>" +
                              "<tr><th>Rw</th><td><a class='url-break' href='" + '/geolevels/rw/' + feature.properties.rw + "' target='_blank'>" + feature.properties.rw_name  + "</a></td></tr>" +
                              "<tr><th>Detail</th><td><a class='url-break' href='" + "{% url "reports:event_list" %}" + feature.id + "' target='_blank'>" + 'View event detail' + "</a></td></tr>" +
                              "<tr><th>Report</th><td><a class='url-break' href='" + "{% url "reports:report_list" %}" + report.id + "' target='_blank'>" + 'View report detail' + "</a></td></tr>" +
                              "<table>";

                layer.on({
                    click: function (e) {
                        $("#feature-title").html(featureName);
                        $("#feature-info").html(content);
                        $("#featureModal").modal("show");
                        highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                        }
                    });

                marker.on({
                    click: function (e) {
                        $("#feature-title").html(featureName);
                        $("#feature-info").html(content);
                        $("#featureModal").modal("show");
                        highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                    }
                });
            },
            });
            $.getJSON("{% url "reports:event_api" %}?disaster=CEK&format=json", function (data) {
            CEK.addData(data);
            });

        var GMPLayer = L.geoJson(null);
        var GMP = L.geoJson(null, {
            style: function (feature) {
            return {
                color: 'blue',
                fill: true,
                opacity: 1,
                clickable: true
                };
            },
        onEachFeature: function (feature, layer) {
            var center;

            //Do looping for reports object

            var report =[];

            var reports = feature.properties.reports;

            for (var i= 0; i < reports.length; i++)
            {
                report = reports[i];
                console.log(report);
            }

            if (feature.geometry.type === 'MultiPolygon') {
                // Get bounds and center of polygon
                var bounds = layer.getBounds();
                center = bounds.getCenter();
                }
            else if (feature.geometry.type === 'Point') {
                center = layer.getLatLng();
                }
            if (feature.properties) {
                var featureName = feature.properties.disaster + '-' + feature.properties.created;
                var featureLocation = feature.properties.province_name + ', ' + feature.properties.city_name + ', ' + feature.properties.subdistrict_name + ', ' + feature.properties.village_name + ', ' + feature.properties.rw_name;
                popupContent = featureName + ': ' + featureLocation;
                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/flood.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');
                GMPSearch.push({
                    name: featureName,
                    location: featureLocation,
                    source: 'GMP',
                    id: L.stamp(layer),
                    lat: center.lat,
                    lng: center.lng
                    });
                }

                // Use center to put a fixed marker on map
            var marker = L.marker(center, {
                icon: L.icon({
                    iconUrl: "{% static 'img/markers/earthquake.png' %}",
                    iconSize: [24, 28],
                    iconAnchor: [12, 28],
                    popupAnchor: [0, -25]
                }),
                title: popupContent,
                riseOnHover: true
            }).addTo(map);

            var content = "<table class='table table-striped table-bordered table-condensed'>" +
                          "<tr><th>Created</th><td>" + feature.properties.created + "</td></tr>" +
                          "<tr><th>Disaster</th><td>" + feature.properties.disaster_note+ "</td></tr>" +
                          "<tr><th>Magnitude</th><td>" + feature.properties.magnitude+ "</td></tr>" +
                          "<tr><th>Province</th><td><a class='url-break' href='" + "{% url "geolevels:province_list" %}" + feature.properties.province + "' target='_blank'>" + feature.properties.province_name  + "</a></td></tr>" +
                          "<tr><th>City</th><td><a class='url-break' href='" + '/geolevels/city/' + feature.properties.city + "' target='_blank'>" + feature.properties.city_name  + "</a></td></tr>" +
                          "<tr><th>Subdistrict</th><td><a class='url-break' href='" + '/geolevels/subdistrict/' + feature.properties.subdistrict + "' target='_blank'>" + feature.properties.subdistrict_name  + "</a></td></tr>" +
                          "<tr><th>Village</th><td><a class='url-break' href='" + '/geolevels/village/' + feature.properties.village + "' target='_blank'>" + feature.properties.village_name  + "</a></td></tr>" +
                          "<tr><th>Rw</th><td><a class='url-break' href='" + '/geolevels/rw/' + feature.properties.rw + "' target='_blank'>" + feature.properties.rw_name  + "</a></td></tr>" +
                          "<tr><th>Detail</th><td><a class='url-break' href='" + "{% url "reports:event_list" %}" + feature.id + "' target='_blank'>" + 'View event detail' + "</a></td></tr>" +
                          "<tr><th>Report</th><td><a class='url-break' href='" + "{% url "reports:report_list" %}" + report.id + "' target='_blank'>" + 'View report detail' + "</a></td></tr>" +
                          "<table>";

            layer.on({
                click: function (e) {
                    $("#feature-title").html(featureName);
                    $("#feature-info").html(content);
                    $("#featureModal").modal("show");
                    highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                    }
                });

            marker.on({
                click: function (e) {
                    $("#feature-title").html(featureName);
                    $("#feature-info").html(content);
                    $("#featureModal").modal("show");
                    highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                }
            });

            },
            });
            $.getJSON("{% url "reports:event_api" %}?disaster=GMP&format=json", function (data) {
            GMP.addData(data);
            });

        var BJRLayer = L.geoJson(null);
        var BJR = L.geoJson(null, {
          style: function (feature) {
            return {
              color: 'blue',
              fill: true,
              opacity: 1,
              clickable: true
            };
          },
        onEachFeature: function (feature, layer) {
            var center;
            //Do looping for reports object

            var report =[];

            var reports = feature.properties.reports;

            for (var i= 0; i < reports.length; i++)
            {
                report = reports[i];
            }
            if (feature.geometry.type === 'MultiPolygon') {
          // Get bounds and center of polygon
            var bounds = layer.getBounds();
            center = bounds.getCenter();
            }
            else if (feature.geometry.type === 'Point') {
                center = layer.getLatLng();

            }
            if (feature.properties) {
                var featureName = feature.properties.disaster + '-' + feature.properties.created;
                var featureLocation = feature.properties.province_name + ', ' + feature.properties.city_name + ', ' + feature.properties.subdistrict_name + ', ' + feature.properties.village_name + ', ' + feature.properties.rw_name;
                popupContent = featureName + ': ' + featureLocation;

                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/flood.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');

                BJRSearch.push({
                    name: featureName,
                    location: featureLocation,
                    source: 'BJR',
                    id: L.stamp(layer),
                    lat: center.lat,
                    lng: center.lng
                    });
                }
                // Use center to put a fixed marker on map
                var marker = L.marker(center, {
                    icon: L.icon({
                        iconUrl: "{% static 'img/markers/flood.png' %}",
                        iconSize: [24, 28],
                        iconAnchor: [12, 28],
                        popupAnchor: [0, -25]
                    }),
                    title: popupContent,
                    riseOnHover: true
                }).addTo(map);

                var content = "<table class='table table-striped table-bordered table-condensed'>" +
                              "<tr><th>Created</th><td>" + feature.properties.created + "</td></tr>" +
                              "<tr><th>Disaster</th><td>" + feature.properties.disaster_note+ "</td></tr>" +
                              "<tr><th>Height</th><td>" + feature.properties.height+ "</td></tr>" +
                              "<tr><th>Province</th><td><a class='url-break' href='" + "{% url "geolevels:province_list" %}" + feature.properties.province + "' target='_blank'>" + feature.properties.province_name  + "</a></td></tr>" +
                              "<tr><th>City</th><td><a class='url-break' href='" + '/geolevels/city/' + feature.properties.city + "' target='_blank'>" + feature.properties.city_name  + "</a></td></tr>" +
                              "<tr><th>Subdistrict</th><td><a class='url-break' href='" + '/geolevels/subdistrict/' + feature.properties.subdistrict + "' target='_blank'>" + feature.properties.subdistrict_name  + "</a></td></tr>" +
                              "<tr><th>Village</th><td><a class='url-break' href='" + '/geolevels/village/' + feature.properties.village + "' target='_blank'>" + feature.properties.village_name  + "</a></td></tr>" +
                              "<tr><th>Rw</th><td><a class='url-break' href='" + '/geolevels/rw/' + feature.properties.rw + "' target='_blank'>" + feature.properties.rw_name  + "</a></td></tr>" +
                              "<tr><th>Detail</th><td><a class='url-break' href='" + "{% url "reports:event_list" %}" + feature.id + "' target='_blank'>" + 'View event detail' + "</a></td></tr>" +
                              "<tr><th>Report</th><td><a class='url-break' href='" + "{% url "reports:report_list" %}" + report.id + "' target='_blank'>" + 'View report detail' + "</a></td></tr>" + "</table>";

                layer.on({
                    click: function (e) {
                        $("#feature-title").html(featureName);
                        $("#feature-info").html(content);
                        $("#featureModal").modal("show");
                        highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                        }
                    });

                marker.on({
                    click: function (e) {
                        $("#feature-title").html(featureName);
                        $("#feature-info").html(content);
                        $("#featureModal").modal("show");
                        highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                    }
                });
                },
            });
        $.getJSON("{% url "reports:event_api" %}?disaster=BJR&format=json", function (data) {
        BJR.addData(data);
        });

        var LSRLayer = L.geoJson(null);
        var LSR = L.geoJson(null, {
            style: function (feature) {
            return {
            color: 'blue',
            fill: true,
            opacity: 1,
            clickable: true
            };
        },
        onEachFeature: function (feature, layer) {
            var center;
            //Do looping for reports object

            var report =[];

            var reports = feature.properties.reports;

            for (var i= 0; i < reports.length; i++)
            {
                report = reports[i];
            }

            if (feature.geometry.type === 'MultiPolygon') {

                var bounds = layer.getBounds();
                center = bounds.getCenter();
            }
            else if (feature.geometry.type === 'Point') {
                center = layer.getLatLng();
            }

            if (feature.properties) {
                var featureName = feature.properties.disaster + '-' + feature.properties.created;
                var featureLocation = feature.properties.province_name + ', ' + feature.properties.city_name + ', ' + feature.properties.subdistrict_name + ', ' + feature.properties.village_name + ', ' + feature.properties.rw_name;
                popupContent = featureName + ': ' + featureLocation;

                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/flood.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');

                LSRSearch.push({
                    name: featureName,
                    location: featureLocation,
                    source: 'LSR',
                    id: L.stamp(layer),
                    lat: center.lat,
                    lng: center.lng
                    });
                }

            // Use center to put a fixed marker on map
                var marker = L.marker(center, {
                icon: L.icon({
                    iconUrl: "{% static 'img/markers/avalanche.png' %}",
                    iconSize: [24, 28],
                    iconAnchor: [12, 28],
                    popupAnchor: [0, -25]
                }),
                title: popupContent,
                riseOnHover: true
                }).addTo(map);

                var content = "<table class='table table-striped table-bordered table-condensed'>" +
                              "<tr><th>Created</th><td>" + feature.properties.created + "</td></tr>" +
                              "<tr><th>Disaster</th><td>" + feature.properties.disaster_note+ "</td></tr>" +
                              "<tr><th>Province</th><td><a class='url-break' href='" + "{% url "geolevels:province_list" %}" + feature.properties.province + "' target='_blank'>" + feature.properties.province_name  + "</a></td></tr>" +
                              "<tr><th>City</th><td><a class='url-break' href='" + '/geolevels/city/' + feature.properties.city + "' target='_blank'>" + feature.properties.city_name  + "</a></td></tr>" +
                              "<tr><th>Subdistrict</th><td><a class='url-break' href='" + '/geolevels/subdistrict/' + feature.properties.subdistrict + "' target='_blank'>" + feature.properties.subdistrict_name  + "</a></td></tr>" +
                              "<tr><th>Village</th><td><a class='url-break' href='" + '/geolevels/village/' + feature.properties.village + "' target='_blank'>" + feature.properties.village_name  + "</a></td></tr>" +
                              "<tr><th>Rw</th><td><a class='url-break' href='" + '/geolevels/rw/' + feature.properties.rw + "' target='_blank'>" + feature.properties.rw_name  + "</a></td></tr>" +
                              "<tr><th>Detail</th><td><a class='url-break' href='" + "{% url "reports:event_list" %}" + feature.id + "' target='_blank'>" + 'View event detail' + "</a></td></tr>" +
                              "<tr><th>Report</th><td><a class='url-break' href='" + "{% url "reports:report_list" %}" + report.id + "' target='_blank'>" + 'View report detail' + "</a></td></tr>" +
                              "<table>";

                layer.on({
                    click: function (e) {
                        $("#feature-title").html(featureName);
                        $("#feature-info").html(content);
                        $("#featureModal").modal("show");
                        highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                        }
                    });

                marker.on({
                    click: function (e) {
                        $("#feature-title").html(featureName);
                        $("#feature-info").html(content);
                        $("#featureModal").modal("show");
                        highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                    }
                });
                 },
            });
        $.getJSON("{% url "reports:event_api" %}?disaster=LSR&format=json", function (data) {
        LSR.addData(data);
        });

        var KBKLayer = L.geoJson(null);
        var KBK = L.geoJson(null, {
            style: function (feature) {
            return {
                color: 'blue',
                fill: true,
                opacity: 1,
                clickable: true
                };
            },
            onEachFeature: function (feature, layer) {
                var center;
                //Do looping for reports object

                var report =[];

                var reports = feature.properties.reports;

                for (var i= 0; i < reports.length; i++)
                {
                    report = reports[i];
                }

            if (feature.geometry.type === 'MultiPolygon') {
                        // Get bounds and center of polygon
                var bounds = layer.getBounds();
                center = bounds.getCenter();
                }
            else if (feature.geometry.type === 'Point') {
                center = layer.getLatLng();
                }

            if (feature.properties) {
                var featureName = feature.properties.disaster;
                var featureLocation = feature.properties.province_name + ', ' + feature.properties.city_name + ', ' + feature.properties.subdistrict_name + ', ' + feature.properties.village_name + ', ' + feature.properties.rw_name;
                popupContent = featureName + ': ' + featureLocation;

                $("#feature-list tbody").append('<tr class="feature-row" id="' + L.stamp(layer) + '" lat="' + center.lat + '" lng="' + center.lng + '"><td style="vertical-align: middle;"><img width="16" height="18" src="{% static 'img/markers/flood.png' %}"></td><td class="feature-name">' + featureName + '<br><small>' + featureLocation + '</small></td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>');

                KBKSearch.push({
                    name: featureName,
                    location: featureLocation,
                    source: 'KBK',
                    id: L.stamp(layer),
                    lat: center.lat,
                    lng: center.lng
                    });
                }

                var marker = L.marker(center, {
                    icon: L.icon({
                        iconUrl: "{% static 'img/markers/fire.png' %}",
                        iconSize: [24, 28],
                        iconAnchor: [12, 28],
                        popupAnchor: [0, -25]
                        }),
                        title: popupContent,
                        riseOnHover: true
                        }).addTo(map);

                var content = "<table class='table table-striped table-bordered table-condensed'>" +
                              "<tr><th>Created</th><td>" + feature.properties.created + "</td></tr>" +
                              "<tr><th>Disaster</th><td>" + feature.properties.disaster_note+ "</td></tr>" +
                              "<tr><th>Province</th><td><a class='url-break' href='" + "{% url "geolevels:province_list" %}" + feature.properties.province + "' target='_blank'>" + feature.properties.province_name  + "</a></td></tr>" +
                              "<tr><th>City</th><td><a class='url-break' href='" + '/geolevels/city/' + feature.properties.city + "' target='_blank'>" + feature.properties.city_name  + "</a></td></tr>" +
                              "<tr><th>Subdistrict</th><td><a class='url-break' href='" + '/geolevels/subdistrict/' + feature.properties.subdistrict + "' target='_blank'>" + feature.properties.subdistrict_name  + "</a></td></tr>" +
                              "<tr><th>Village</th><td><a class='url-break' href='" + '/geolevels/village/' + feature.properties.village + "' target='_blank'>" + feature.properties.village_name  + "</a></td></tr>" +
                              "<tr><th>Rw</th><td><a class='url-break' href='" + '/geolevels/rw/' + feature.properties.rw + "' target='_blank'>" + feature.properties.rw_name  + "</a></td></tr>" +
                              "<tr><th>Detail</th><td><a class='url-break' href='" + "{% url "reports:event_list" %}" + feature.id + "' target='_blank'>" + 'View event detail' + "</a></td></tr>" +
                              "<tr><th>Report</th><td><a class='url-break' href='" + "{% url "reports:report_list" %}" + report.id + "' target='_blank'>" + 'View report detail' + "</a></td></tr>" +
                              "<table>";

                layer.on({
                    click: function (e) {
                        $("#feature-title").html(featureName);
                        $("#feature-info").html(content);
                        $("#featureModal").modal("show");
                        highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                        }
                    });

                marker.on({
                    click: function (e) {
                        $("#feature-title").html(featureName);
                        $("#feature-info").html(content);
                        $("#featureModal").modal("show");
                        highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
                    }
                });
            },
            });
            $.getJSON("{% url "reports:event_api" %}?disaster=KBK&format=json", function (data) {
            KBK.addData(data);
            });

        map = L.map("map", {
          zoom: 13,
          center: [-6.134410, 106.813545],
          layers: [mapquestOSM, markerClusters, highlight],
          zoomControl: false,
          attributionControl: false
        });

        /* Layer control listeners that allow for a single markerClusters layer */
        map.on("overlayadd", function(e) {

          //DISASTER
          if (e.layer === BJRLayer) {
            markerClusters.addLayer(BJR);
            syncSidebar();
          }

          if (e.layer === LSRLayer) {
            markerClusters.addLayer(LSR);
            syncSidebar();
          }

          if (e.layer === KBKLayer) {
            markerClusters.addLayer(KBK);
            syncSidebar();
          }

          if (e.layer === GMPLayer) {
            markerClusters.addLayer(GMP);
            syncSidebar();
          }

          if (e.layer === CEKLayer) {
            markerClusters.addLayer(CEK);
            syncSidebar();
          }

          if (e.layer === SOSLayer) {
            markerClusters.addLayer(SOS);
            syncSidebar();
          }

          if (e.layer === ROBLayer) {
            markerClusters.addLayer(ROB);
            syncSidebar();
          }

          if (e.layer === TSULayer) {
            markerClusters.addLayer(TSU);
            syncSidebar();
          }

          if (e.layer === ABRLayer) {
            markerClusters.addLayer(ABR);
            syncSidebar();
          }

          if (e.layer === TERLayer) {
            markerClusters.addLayer(TER);
            syncSidebar();
          }

          if (e.layer === LAILayer) {
            markerClusters.addLayer(LAI);
            syncSidebar();
          }
        });
        map.on("overlayremove", function(e) {
          if (e.layer === BJRLayer) {
            markerClusters.removeLayer(BJR);
            syncSidebar();
          }

          if (e.layer === LSRLayer) {
            markerClusters.removeLayer(LSR);
            syncSidebar();
          }
          if (e.layer === KBKLayer) {
            markerClusters.removeLayer(KBK);
            syncSidebar();
          }

          if (e.layer === GMPLayer) {
            markerClusters.removeLayer(GMP);
            syncSidebar();
          }

          if (e.layer === CEKLayer) {
            markerClusters.removeLayer(CEK);
            syncSidebar();
          }

          if (e.layer === SOSLayer) {
            markerClusters.removeLayer(SOS);
            syncSidebar();
          }

          if (e.layer === ROBLayer) {
            markerClusters.removeLayer(ROB);
            syncSidebar();
          }

          if (e.layer === TSULayer) {
            markerClusters.removeLayer(TSU);
            syncSidebar();
          }

          if (e.layer === ABRLayer) {
            markerClusters.removeLayer(ABR);
            syncSidebar();
          }

          if (e.layer === TERLayer) {
            markerClusters.removeLayer(TER);
            syncSidebar();
          }

          if (e.layer === LAILayer) {
            markerClusters.removeLayer(LAI);
            syncSidebar();
          }
        });
        /* Filter sidebar feature list to only show features in current map bounds */
        map.on("moveend", function (e) {
          syncSidebar();
        });

        /* Clear feature highlight when map is clicked */
        map.on("click", function(e) {
          highlight.clearLayers();
        });

        /* Attribution control */
        function updateAttribution(e) {
          $.each(map._layers, function(index, layer) {
            if (layer.getAttribution) {
              $("#attribution").html((layer.getAttribution()));
            }
          });
        }
        map.on("layeradd", updateAttribution);
        map.on("layerremove", updateAttribution);

        var attributionControl = L.control({
          position: "bottomright"
        });
        attributionControl.onAdd = function (map) {
          var div = L.DomUtil.create("div", "leaflet-control-attribution");
          div.innerHTML = "<span class='hidden-xs'>Developed by <a href='http://bryanmcbride.com'>bryanmcbride.com</a> | </span><a href='#' onclick='$(\"#attributionModal\").modal(\"show\"); return false;'>Attribution</a>";
          return div;
        };
        map.addControl(attributionControl);

        var zoomControl = L.control.zoom({
          position: "bottomright"
        }).addTo(map);

        /* GPS enabled geolocation control set to follow the user's location */
        var locateControl = L.control.locate({
          position: "bottomright",
          drawCircle: true,
          follow: true,
          setView: true,
          keepCurrentZoomLevel: true,
          markerStyle: {
            weight: 1,
            opacity: 0.8,
            fillOpacity: 0.8
          },
          circleStyle: {
            weight: 1,
            clickable: false
          },
          icon: "fa fa-location-arrow",
          metric: false,
          strings: {
            title: "My location",
            popup: "You are within {distance} {unit} from this point",
            outsideMapBoundsMsg: "You seem located outside the boundaries of the map"
          },
          locateOptions: {
            maxZoom: 18,
            watch: true,
            enableHighAccuracy: true,
            maximumAge: 10000,
            timeout: 10000
          }
        }).addTo(map);

        /* Larger screens get expanded layer control and visible sidebar */
        if (document.body.clientWidth <= 767) {
          var isCollapsed = true;
        } else {
          var isCollapsed = false;
        }

        var baseLayers = {
          "Street Map": mapquestOSM,
          "Aerial Imagery": mapquestOAM,
          "Imagery with Streets": mapquestHYB
        };

        var groupedOverlays = {
          //DISASTER
          "Affected Area": {
            "<img src='{% static "img/markers/abration.png" %}' width='24' height='28'>&nbsp;Abrasi": ABRLayer,
            "<img src='{% static "img/markers/flood.png" %}' width='24' height='28'>&nbsp;Banjir": BJRLayer,
            "<img src='{% static "img/markers/seaflood.png" %}' width='24' height='28'>&nbsp;Banjir Laut": ROBLayer,
            "<img src='{% static "img/markers/earthquake.png" %}' width='24' height='28'>&nbsp;Gempa Bumi": GMPLayer,
            "<img src='{% static "img/markers/fire.png" %}' width='24' height='28'>&nbsp;Kebakaran": KBKLayer,
            "<img src='{% static "img/markers/treedown.png" %}' width='24' height='28'>&nbsp;Lain-lain": LAILayer,
            "<img src='{% static "img/markers/avalanche.png" %}' width='24' height='28'>&nbsp;Longsor": LSRLayer,
            "<img src='{% static "img/markers/tornado.png" %}' width='24' height='28'>&nbsp;Puting Beliung": CEKLayer,
            "<img src='{% static "img/markers/strike.png" %}' width='24' height='28'>&nbsp;Tawuran": SOSLayer,
            "<img src='{% static "img/markers/shooting.png" %}' width='24' height='28'>&nbsp;Teror": TERLayer,
            "<img src='{% static "img/markers/tsunami.png" %}' width='24' height='28'>&nbsp;Tsunami": TSULayer,
          },
        };

        var layerControl = L.control.groupedLayers(baseLayers, groupedOverlays, {
          collapsed: isCollapsed
        }).addTo(map);

        /* Highlight search box text on click */
        $("#searchbox").click(function () {
          $(this).select();
        });

        /* Prevent hitting enter from refreshing the page */
        $("#searchbox").keypress(function (e) {
          if (e.which == 13) {
            e.preventDefault();
          }
        });

        $("#featureModal").on("hidden.bs.modal", function (e) {
          $(document).on("mouseout", ".feature-row", clearHighlight);
        });

        /* Typeahead search functionality */
        $(document).one("ajaxStop", function () {
          $("#loading").hide();
          sizeLayerControl();
          map.fitBounds(BJR.getBounds());

          featureList = new List("features", {valueNames: ["feature-name"]});
          featureList.sort("feature-name", {order:"asc"});

          var BJRBH = new Bloodhound({
            name: "BJR : Banjir",
            datumTokenizer: function (d) {
            return Bloodhound.tokenizers.whitespace(d.name);
            },
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            local: BJRSearch,
            limit: 10
          });

          var LAIBH = new Bloodhound({
            name: "LAI",
            datumTokenizer: function (d) {
            return Bloodhound.tokenizers.whitespace(d.name);
            },
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            local: LAISearch,
            limit: 10
          });

          var KBKBH = new Bloodhound({
            name: "KBK",
            datumTokenizer: function (d) {
            return Bloodhound.tokenizers.whitespace(d.name);
            },
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            local: KBKSearch,
            limit: 10
          });

          var LSRBH = new Bloodhound({
            name: "LSR",
            datumTokenizer: function (d) {
            return Bloodhound.tokenizers.whitespace(d.name);
            },
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            local: LSRSearch,
            limit: 10
          });

          var SOSBH = new Bloodhound({
            name: "SOS",
            datumTokenizer: function (d) {
            return Bloodhound.tokenizers.whitespace(d.name);
            },
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            local: SOSSearch,
            limit: 10
          });

          var ROBBH = new Bloodhound({
            name: "ROB",
            datumTokenizer: function (d) {
            return Bloodhound.tokenizers.whitespace(d.name);
            },
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            local: ROBSearch,
            limit: 10
          });

          var GMPBH = new Bloodhound({
            name: "GMP",
            datumTokenizer: function (d) {
            return Bloodhound.tokenizers.whitespace(d.name);
            },
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            local: GMPSearch,
            limit: 10
          });

          var TERBH = new Bloodhound({
            name: "TER",
            datumTokenizer: function (d) {
            return Bloodhound.tokenizers.whitespace(d.name);
            },
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            local: TERSearch,
            limit: 10
          });

          var ABRBH = new Bloodhound({
            name: "ABR",
            datumTokenizer: function (d) {
            return Bloodhound.tokenizers.whitespace(d.name);
            },
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            local: ABRSearch,
            limit: 10
          });

          var TSUBH = new Bloodhound({
            name: "TSU",
            datumTokenizer: function (d) {
            return Bloodhound.tokenizers.whitespace(d.name);
            },
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            local: TSUSearch,
            limit: 10
          });

          var CEKBH = new Bloodhound({
            name: "CEK",
            datumTokenizer: function (d) {
            return Bloodhound.tokenizers.whitespace(d.name);
            },
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            local: CEKSearch,
            limit: 10
          });

          var geonamesBH = new Bloodhound({
            name: "GeoNames",
            datumTokenizer: function (d) {
              return Bloodhound.tokenizers.whitespace(d.name);
            },
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            remote: {
              url: "http://api.geonames.org/searchJSON?username=bootleaf&featureClass=P&maxRows=5&countryCode=US&name_startsWith=%QUERY",
              filter: function (data) {
                return $.map(data.geonames, function (result) {
                return {
                    name: result.name + ", " + result.adminCode1,
                    lat: result.lat,
                    lng: result.lng,
                    source: "GeoNames"
                  };
                });
              },
              ajax: {
                beforeSend: function (jqXhr, settings) {
                  settings.url += "&east=" + map.getBounds().getEast() + "&west=" + map.getBounds().getWest() + "&north=" + map.getBounds().getNorth() + "&south=" + map.getBounds().getSouth();
                  $("#searchicon").removeClass("fa-search").addClass("fa-refresh fa-spin");
                },
                complete: function (jqXHR, status) {
                  $('#searchicon').removeClass("fa-refresh fa-spin").addClass("fa-search");
                }
              }
            },
            limit: 10
        });

          BJRBH.initialize();
          KBKBH.initialize();
          ABRBH.initialize();
          GMPBH.initialize();
          SOSBH.initialize();
          TERBH.initialize();
          ROBBH.initialize();
          TSUBH.initialize();
          LAIBH.initialize();
          LSRBH.initialize();
          CEKBH.initialize();
          geonamesBH.initialize();

          /* instantiate the typeahead UI */
          $("#searchbox").typeahead({
            minLength: 3,
            highlight: true,
            hint: false
          },
          {
            name: "BJR",
            displayKey: "name",
            source: BJRBH.ttAdapter(),
            templates: {
              header: "<h4 class='typeahead-header'><img src='{% static "img/markers/flood.png" %}' width='24' height='28'>&nbsp;Banjir</h4>",
              suggestion: function (data) {
                return data.name + '<br><small>' + data.location + '</small>';
              }
            }
          },
          {
            name: "ABR",
            displayKey: "name",
            source: ABRBH.ttAdapter(),
            templates: {
              header: "<h4 class='typeahead-header'><img src='{% static "img/markers/abration.png" %}' width='24' height='28'>&nbsp;Abrasi</h4>",
              suggestion: function (data) {
                return data.name + '<br><small>' + data.location + '</small>';
              }
            }
          },
          {
            name: "ROB",
            displayKey: "name",
            source: ROBBH.ttAdapter(),
            templates: {
              header: "<h4 class='typeahead-header'><img src='{% static "img/markers/seaflood.png" %}' width='24' height='28'>&nbsp;Banjir Laut</h4>",
              suggestion: function (data) {
                return data.name + '<br><small>' + data.location + '</small>';
              }
            }
          },
          {
            name: "TSU",
            displayKey: "name",
            source: TSUBH.ttAdapter(),
            templates: {
              header: "<h4 class='typeahead-header'><img src='{% static "img/markers/tsunami.png" %}' width='24' height='28'>&nbsp;Tsunami</h4>",
              suggestion: function (data) {
                return data.name + '<br><small>' + data.location + '</small>';
              }
            }
          },
          {
            name: "LSR",
            displayKey: "name",
            source: LSRBH.ttAdapter(),
            templates: {
              header: "<h4 class='typeahead-header'><img src='{% static "img/markers/avalanche.png" %}' width='24' height='28'>&nbsp;Longsor</h4>",
              suggestion: function (data) {
                return data.name + '<br><small>' + data.location + '</small>';
              }
            }
          },
          {
            name: "SOS",
            displayKey: "name",
            source: SOSBH.ttAdapter(),
            templates: {
              header: "<h4 class='typeahead-header'><img src='{% static "img/markers/strike.png" %}' width='24' height='28'>&nbsp;Tawuran</h4>",
              suggestion: function (data) {
                return data.name + '<br><small>' + data.location + '</small>';
              }
            }
          },
          {
            name: "TER",
            displayKey: "name",
            source: TERBH.ttAdapter(),
            templates: {
              header: "<h4 class='typeahead-header'><img src='{% static "img/markers/shooting.png" %}' width='24' height='28'>&nbsp;Teror</h4>",
              suggestion: function (data) {
                return data.name + '<br><small>' + data.location + '</small>';
              }
            }
          },
          {
            name: "LAI",
            displayKey: "name",
            source: LAIBH.ttAdapter(),
            templates: {
              header: "<h4 class='typeahead-header'><img src='{% static "img/markers/treedown.png" %}' width='24' height='28'>&nbsp;Pohon Tumbang</h4>",
              suggestion: function (data) {
                return data.name + '<br><small>' + data.location + '</small>';
              }
            }
          },
          {
            name: "GMP",
            displayKey: "name",
            source: GMPBH.ttAdapter(),
            templates: {
              header: "<h4 class='typeahead-header'><img src='{% static "img/markers/earthquake.png" %}' width='24' height='28'>&nbsp;Gempa Bumi</h4>",
              suggestion: function (data) {
                return data.name + '<br><small>' + data.location + '</small>';
              }
            }
          },
          {
            name: "KBK",
            displayKey: "name",
            source: KBKBH.ttAdapter(),
            templates: {
              header: "<h4 class='typeahead-header'><img src='{% static "img/markers/fire.png" %}' width='24' height='28'>&nbsp;Kebakaran</h4>",
              suggestion: function (data) {
                return data.name + '<br><small>' + data.location + '</small>';
              }
            }
          },
           {
            name: "CEK",
            displayKey: "name",
            source: CEKBH.ttAdapter(),
            templates: {
              header: "<h4 class='typeahead-header'><img src='{% static "img/markers/tornado.png" %}' width='25' height='25'>&nbsp;Puting Beliung</h4>",
              suggestion: function (data) {
                return data.name + '<br><small>' + data.location + '</small>';
              }
            }
        },
        {
          name: "GeoNames",
          displayKey: "name",
          source: geonamesBH.ttAdapter(),
          templates: {
            header: "<h4 class='typeahead-header'><img src='{% static "bootleaf_example/assets/img/globe.png" %}' width='25' height='25'>&nbsp;GeoNames</h4>"
          }
      }

      ).on("typeahead:selected", function (obj, datum) {
          if (datum.source === "LAI") {
            if (!map.hasLayer(LAILayer)) {
              map.addLayer(LAILayer);
            }
            map.setView([datum.lat, datum.lng], 17);
            if (map._layers[datum.id]) {
              map._layers[datum.id].fire("click");
            }
            }
            if (datum.source === "ROB") {
              if (!map.hasLayer(ROBLayer)) {
                map.addLayer(ROBLayer);
              }
              map.setView([datum.lat, datum.lng], 17);
              if (map._layers[datum.id]) {
                map._layers[datum.id].fire("click");
              }
            }
            if (datum.source === "GMP") {
              if (!map.hasLayer(GMPLayer)) {
                map.addLayer(GMPLayer);
              }
              map.setView([datum.lat, datum.lng], 17);
              if (map._layers[datum.id]) {
                map._layers[datum.id].fire("click");
              }
            }
            if (datum.source === "ABR") {
              if (!map.hasLayer(ABRLayer)) {
                map.addLayer(ABRLayer);
              }
              map.setView([datum.lat, datum.lng], 17);
              if (map._layers[datum.id]) {
                map._layers[datum.id].fire("click");
              }
            }
            if (datum.source === "BJR") {
              if (!map.hasLayer(BJRLayer)) {
                map.addLayer(BJRLayer);
              }
              map.setView([datum.lat, datum.lng], 17);
              if (map._layers[datum.id]) {
                map._layers[datum.id].fire("click");
              }
            }
            if (datum.source === "CEK") {
              if (!map.hasLayer(CEKLayer)) {
                map.addLayer(CEKLayer);
              }
              map.setView([datum.lat, datum.lng], 17);
              if (map._layers[datum.id]) {
                map._layers[datum.id].fire("click");
              }
            }
            if (datum.source === "TSU") {
              if (!map.hasLayer(TSULayer)) {
                map.addLayer(TSULayer);
              }
              map.setView([datum.lat, datum.lng], 17);
              if (map._layers[datum.id]) {
                map._layers[datum.id].fire("click");
              }
            }
            if (datum.source === "SOS") {
              if (!map.hasLayer(SOSLayer)) {
                map.addLayer(SOSLayer);
              }
              map.setView([datum.lat, datum.lng], 17);
              if (map._layers[datum.id]) {
                map._layers[datum.id].fire("click");
              }
            }
            if (datum.source === "LSR") {
              if (!map.hasLayer(LSRLayer)) {
                map.addLayer(LSRLayer);
              }
              map.setView([datum.lat, datum.lng], 17);
              if (map._layers[datum.id]) {
                map._layers[datum.id].fire("click");
              }
            }
            if (datum.source === "KBK") {
              if (!map.hasLayer(KBKLayer)) {
                map.addLayer(KBKLayer);
              }
              map.setView([datum.lat, datum.lng], 17);
              if (map._layers[datum.id]) {
                map._layers[datum.id].fire("click");
              }
            }
            if (datum.source === "TER") {
              if (!map.hasLayer(TERLayer)) {
                map.addLayer(TERLayer);
              }
              map.setView([datum.lat, datum.lng], 17);
              if (map._layers[datum.id]) {
                map._layers[datum.id].fire("click");
              }
            }
            if (datum.source === "ROB") {
              if (!map.hasLayer(ROBLayer)) {
                map.addLayer(ROBLayer);
              }
              map.setView([datum.lat, datum.lng], 17);
              if (map._layers[datum.id]) {
                map._layers[datum.id].fire("click");
              }
            }
            if (datum.source === "GeoNames") {
              map.setView([datum.lat, datum.lng], 14);
            }
            if ($(".navbar-collapse").height() > 50) {
              $(".navbar-collapse").collapse("hide");
            }
          }).on("typeahead:opened", function () {
            $(".navbar-collapse.in").css("max-height", $(document).height() - $(".navbar-header").height());
            $(".navbar-collapse.in").css("height", $(document).height() - $(".navbar-header").height());
          }).on("typeahead:closed", function () {
            $(".navbar-collapse.in").css("max-height", "");
            $(".navbar-collapse.in").css("height", "");
          });
          $(".twitter-typeahead").css("position", "static");
          $(".twitter-typeahead").css("display", "block");
      });

        // Leaflet patch to make layer control scrollable on touch browsers
        var container = $(".leaflet-control-layers")[0];
        if (!L.Browser.touch) {
          L.DomEvent
          .disableClickPropagation(container)
          .disableScrollPropagation(container);
        } else {
          L.DomEvent.disableClickPropagation(container);
        }
    });
    </script>
  </body>
</html>
